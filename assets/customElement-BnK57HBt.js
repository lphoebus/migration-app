import{L as P,c as w,u as D,a as p,d as k,v as M,f as g,J as T,p as O,I as R,s as f,n as C,x as h,i as H,G as N,b as U}from"./index-Cv1x7wWx.js";import{i as v}from"./keyed-QbGVL7HE.js";import{l as I,a as E,b as S,i as A,e as G,u as z}from"./utils-DqR-LCPw.js";import{d as B,c as q}from"./sortableComponent-DNdMIoBB.js";import{S as $}from"./resources-BHbb0pmw.js";import{n as y}from"./locale-D1gvuWjW.js";import{d as W}from"./debounce-DbkufipY.js";/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.0 */const u={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},L={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},K=H`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,J=`${S}, ${I}`,b=class b extends P{constructor(){super(),this.dragSelector=I,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=w("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=W(()=>{this.updateGroupItems();const{selectionAppearance:e,selectionMode:i,interactionMode:t,dragEnabled:s,el:a,filterEl:l,moveToItems:r,displayMode:n,scale:c,defaultSlotEl:d}=this,m=Array.from(this.el.querySelectorAll(I));if(m.forEach(o=>{o.scale=c,o.selectionAppearance=e,o.selectionMode=i,o.interactionMode=t,o.closest(E)===a&&(o.moveToItems=r.filter(x=>x.element!==a&&!o.contains(x.element)),o.dragHandle=s,o.displayMode=n)}),this.parentListEl){this.setUpSorting();return}this.listItems=m,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),l&&(l.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(o=>!o.closed&&!o.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(o=>!o.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting(),d&&z(d)},N.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.messages=D({blocking:!0}),this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=p({cancelable:!1}),this.calciteListChange=p({cancelable:!1}),this.calciteListDragEnd=p({cancelable:!1}),this.calciteListDragStart=p({cancelable:!1}),this.calciteListFilter=p({cancelable:!1}),this.calciteListMoveHalt=p({cancelable:!1}),this.calciteListOrderChange=p({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}putFailed(e){this.calciteListMoveHalt.emit(e)}async setFocus(){var e,i;return await k(this),this.filterEnabled?(e=this.filterEl)==null?void 0:e.setFocus():(i=this.focusableItems.find(t=>t.active))==null?void 0:i.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){M(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),B(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();const{focusableItems:i}=this,s=i.findIndex(a=>a.active)-1;i[s]&&this.focusRow(i[s])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:t}=this;t.forEach(s=>{s.active=s===i})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleReorder(e))}handleSortMove(e){this.parentListEl||e.defaultPrevented||(e.preventDefault(),this.handleMove(e))}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();const i=e.target,{listItems:t,selectionMode:s}=this;i.selected&&(s==="single"||s==="single-persist")&&t.forEach(a=>a.selected=a===i),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();const{target:i,detail:t}=e,{focusableItems:s,lastSelectedInfo:a}=this,l=i;if(t.selectMultiple&&a){const r=s.indexOf(l),n=s.indexOf(a.selectedItem),c=Math.min(n,r),d=Math.max(n,r);s.slice(c,d+1).forEach(m=>m.selected=a.selected)}else this.lastSelectedInfo={selectedItem:l,selected:l.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){var e;(e=this.mutationObserver)==null||e.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){var e;(e=this.mutationObserver)==null||e.disconnect()}setUpSorting(){const{dragEnabled:e}=this;e&&q(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){var e;this.parentListEl=(e=this.el.parentElement)==null?void 0:e.closest(E)}handleDefaultSlotChange(){this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(S))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=g(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=g(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=g(e)}setActiveListItem(){const{focusableItems:e}=this;e.some(i=>i.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(i=>i.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:i,visibleParents:t}){const s=!t.has(e)&&!i.includes(e);e.filterHidden=s;const a=e.parentElement.closest(J);a&&(s||t.add(a),this.filterElements({el:a,filteredItems:i,visibleParents:t}))}allParentListItemsExpanded(e){var t;const i=(t=e.parentElement)==null?void 0:t.closest(I);if(i){if(!i.expanded)return!1}else return!0;return this.allParentListItemsExpanded(i)}borderItems(){const e=this.visibleItems.filter(i=>!i.filterHidden&&this.allParentListItemsExpanded(i));e.forEach(i=>i.bordered=i!==e[e.length-1])}updateFilteredItems(){const{visibleItems:e,filteredData:i,filterText:t,filterPredicate:s}=this,a=e==null?void 0:e.filter(n=>e.every(c=>c===n||!n.contains(c))),l=s?e.filter(s):t?i.map(n=>n.el):e||[],r=new WeakSet;a.forEach(n=>this.filterElements({el:n,filteredItems:l,visibleParents:r})),this.filteredItems=l,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){const{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){var e;await((e=this.filterEl)==null?void 0:e.filter(this.filterText)),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){const{filterEl:e,filterText:i,effectiveFilterProps:t}=this;e&&(e.value=i,e.filterProps=t,this.filterAndUpdateData())}setDefaultSlotEl(e){this.defaultSlotEl=e}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();const{value:i}=e.currentTarget;this.filterText=i,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(t=>t.contains(e)).map(t=>t.heading)}updateGroupItems(){const{el:e,group:i,scale:t}=this,s=T(e),a=i?Array.from(s.querySelectorAll(`${E}[group="${i}"]`)).filter(r=>!r.disabled&&r.dragEnabled):[];this.moveToItems=a.map(r=>({element:r,label:r.label??r.id,id:O()})),Array.from(this.el.querySelectorAll(S)).forEach(r=>{r.scale=t})}focusRow(e){const{focusableItems:i}=this;e&&(i.forEach(t=>t.active=t===e),e.setFocus())}isNavigable(e){var t;const i=(t=e.parentElement)==null?void 0:t.closest(I);return i?i.expanded&&this.isNavigable(i):!0}handleListKeydown(e){var a;if(e.defaultPrevented||this.parentListEl)return;const{key:i}=e,t=this.focusableItems.filter(l=>this.isNavigable(l)),s=t.findIndex(l=>l.active);if(i==="ArrowDown"){e.preventDefault();const l=e.target===this.filterEl?0:s+1;t[l]&&this.focusRow(t[l])}else if(i==="ArrowUp"){if(e.preventDefault(),s===0&&this.filterEnabled){(a=this.filterEl)==null||a.setFocus();return}const l=s-1;t[l]&&this.focusRow(t[l])}else if(i==="Home"){e.preventDefault();const l=t[0];l&&this.focusRow(l)}else if(i==="End"){e.preventDefault();const l=t[t.length-1];l&&this.focusRow(l)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){var c,d;const{moveTo:i}=e.detail,t=e.target,s=t==null?void 0:t.parentElement,a=i.element,r=Array.from(s.children).filter(A).indexOf(t),n=0;if(s){if(((c=s.canPull)==null?void 0:c.call(s,{toEl:a,fromEl:s,dragEl:t,newIndex:n,oldIndex:r}))===!1){this.calciteListMoveHalt.emit({toEl:a,fromEl:s,dragEl:t,oldIndex:r,newIndex:n});return}if(((d=a.canPut)==null?void 0:d.call(a,{toEl:a,fromEl:s,dragEl:t,newIndex:n,oldIndex:r}))===!1){a.putFailed({toEl:a,fromEl:s,dragEl:t,oldIndex:r,newIndex:n});return}t.sortHandleOpen=!1,this.disconnectObserver(),a.prepend(t),G(t),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:t,fromEl:s,toEl:a,newIndex:n,oldIndex:r})}}handleReorder(e){const{reorder:i}=e.detail,t=e.target,s=t==null?void 0:t.parentElement;if(!s)return;t.sortHandleOpen=!1;const a=Array.from(s.children).filter(A),l=a.length-1,r=a.indexOf(t);let n=r;switch(i){case"top":n=0;break;case"bottom":n=l;break;case"up":n=r===0?0:r-1;break;case"down":n=r===l?l:r+1;break}this.disconnectObserver();const c=i==="up"||i==="top"?a[n]:a[n].nextSibling;s.insertBefore(t,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:t,fromEl:s,toEl:s,newIndex:n,oldIndex:r})}render(){const{loading:e,label:i,disabled:t,dataForFilter:s,filterEnabled:a,filterPlaceholder:l,filterText:r,filterLabel:n,hasFilterActionsStart:c,hasFilterActionsEnd:d,effectiveFilterProps:m}=this;return R({disabled:this.disabled,children:h`<div class=${f(u.container)}>${this.dragEnabled?h`<span aria-live=assertive class=${f(u.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?h`<calcite-scrim class=${f(u.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${i||""} class=${f(u.table)} @keydown=${this.handleListKeydown} role=treegrid>${a||c||d?h`<div class=${f(u.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${f(u.stack)}><slot name=${L.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${$.actionsStart}></slot><calcite-filter .ariaLabel=${l} .disabled=${t} .filterProps=${m} .items=${s} .label=${n} @calciteFilterChange=${this.handleFilterChange} .placeholder=${l} .scale=${this.scale} .value=${r} ${C(this.setFilterEl)}></calcite-filter><slot name=${L.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${$.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${f(u.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange} ${C(this.setDefaultSlotEl)}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${L.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){const{messages:e,filteredItems:i,parentListEl:t,messages:{_lang:s},numberingSystem:a}=this;return y.numberFormatOptions={locale:s,numberingSystem:a},t?null:h`<div aria-live=polite class=${f(u.assistiveText)}>${this.hasActiveFilter?v("aria-filter-enabled",h`<div>${e.filterEnabled}</div>`):null}${v("aria-item-count",h`<div>${e.total.replace("{count}",y.localize(i.length.toString()))}</div>`)}${i.length?v("aria-item-list",h`<ol>${i.map(l=>h`<li>${l.label}</li>`)}</ol>`):null}</div>`}};b.properties={assistiveText:[16,{},{state:!0}],dataForFilter:[16,{},{state:!0}],hasFilterActionsEnd:[16,{},{state:!0}],hasFilterActionsStart:[16,{},{state:!0}],hasFilterNoResults:[16,{},{state:!0}],moveToItems:[16,{},{state:!0}],hasActiveFilter:[16,{},{state:!0}],showNoResultsContainer:[16,{},{state:!0}],canPull:[0,{},{attribute:!1}],canPut:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],dragEnabled:[7,{},{reflect:!0,type:Boolean}],filterEnabled:[7,{},{reflect:!0,type:Boolean}],filterPredicate:[0,{},{attribute:!1}],filterLabel:[3,{},{reflect:!0}],filterPlaceholder:[3,{},{reflect:!0}],filterProps:[0,{},{attribute:!1}],filterText:[3,{},{reflect:!0}],filteredData:[0,{},{attribute:!1}],filteredItems:[0,{},{attribute:!1}],group:[3,{},{reflect:!0}],interactionMode:[3,{},{reflect:!0}],label:1,loading:[7,{},{reflect:!0,type:Boolean}],messageOverrides:[0,{},{attribute:!1}],displayMode:[3,{},{reflect:!0}],numberingSystem:1,scale:[3,{},{reflect:!0}],selectedItems:[0,{},{attribute:!1}],selectionAppearance:[3,{},{reflect:!0}],selectionMode:[3,{},{reflect:!0}]},b.styles=K;let F=b;U("calcite-list",F);export{F as List};
