const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/arcgis-knowledge-client-core-simd-DfztjkvI.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/arcgis-knowledge-client-core-CdzkaQcp.js","assets/lclayout-jnpuPyOe.js","assets/index-Byn_dG8u.js","assets/index-xat1a9-L.css","assets/MapImageLayer-DpazwgTT.js","assets/SublayersOwner-wmakwA4w.js","assets/QueryTask-BLsfHZFG.js","assets/executeForIds-MALQLLov.js","assets/featureConversionUtils-JEm3Yhrc.js","assets/imageBitmapUtils-Cafu-Et7.js"])))=>i.map(i=>d[i]);
import{cp as de,aR as vn,ak as nt,gf as Pt,aK as W,en as fe,bJ as In,ax as w,fE as En,bQ as sr,ey as Kt,dh as Me,cq as Sn,a$ as s,b0 as p,dw as Fe,b1 as j,aT as K,d5 as bt,ex as $n,b6 as Rn,fI as De,ef as ht,fK as Nn,e$ as ze,bX as lr,bZ as Je,h6 as Zt,fD as Hr,aI as Xt,cr as Tt,cs as it,ba as Ae,dl as Mn,c6 as Dn,hT as Pe,cX as jt,f8 as be,dF as dt,s6 as pr,jc as Pn,jf as Oe,eU as Xe,v3 as et,gD as ur,hr as jn,j4 as kn,j5 as Gn,j6 as Cn,dp as xn,j3 as Ln,eK as On,dt as Fn,dq as An,du as qn,v4 as Un,fq as Ue,j8 as zn,gh as Jn,eg as dr,ln as cr,ja as Bn,j9 as Vn,dv as Hn,aS as ee,v5 as Qn,v6 as Yn,v7 as Wn,v8 as Kn,v9 as Zn,va as Xn,dy as eo,jE as to,jF as ro,jg as no,vb as oo,jh as io,eh as ao,jj as so,lI as lo,eo as po,pb as uo,je as co,ek as yo}from"./index-Byn_dG8u.js";import{I as ft,t as mt,_ as le,E as tt,S as er,o as kt}from"./constants-B4mRqufT.js";import{s as ho}from"./featureConversionUtils-JEm3Yhrc.js";import{c as Qr,a as Yr,b as fo,t as mo,p as Ie}from"./GraphQueryStreaming-ClzyB6i3.js";import{f as go}from"./FeatureStore-C9TTerSS.js";import{L as wo}from"./QueryEngine-BzUwOchY.js";import{y as _o,u as yr}from"./clientSideDefaults-Cb70BwC-.js";import{s as bo,t as To}from"./networkEnums-BSEftqwN.js";import{a as vo}from"./GPMessage-CclJT_go.js";let Io=class{constructor(){this.version="",this.queryResult=new Eo}},Eo=class{constructor(){this.featureResult=new So}},So=class{constructor(){this.objectIdFieldName="",this.uniqueIdField=new $o,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new Ro,this.geometryType=null,this.spatialReference=new de,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new Wr,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}},$o=class{constructor(){this.name="",this.isSystemMaintained=!1}},Ro=class{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}},Wr=class{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new No,this.translate=new Mo}},No=class{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}},Mo=class{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}},Do=class{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}},Po=class{constructor(){this.attributes=[],this.compressedGeometry=new Gt,this.centroid=new Gt,this.aggregateGeometries=[]}},Gt=class{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}};var qe;(function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"})(qe||(qe={}));const jo=[qe.ELEMENTUID,qe.TYPENAME];var hr,fr;(function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"})(hr||(hr={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(fr||(fr={}));const mr="esri/rest/knowledgeGraph/wasmInterface/";let Et;async function re(){const e=Et;if(e)return e;const t=!!vn("wasm-simd");return Et=ko(t),Et}async function ko(e){if(e){const{default:r}=await nt(()=>import("./arcgis-knowledge-client-core-simd-DfztjkvI.js"),__vite__mapDeps([0,1])).then(n=>n.a);return r({locateFile:n=>Pt(mr+n)})}const{default:t}=await nt(()=>import("./arcgis-knowledge-client-core-CdzkaQcp.js"),__vite__mapDeps([2,1])).then(r=>r.a);return t({locateFile:r=>Pt(mr+r)})}var Ct,ot,Ne,xt,Lt,Ot,Ft;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(Ct||(Ct={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(ot||(ot={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Ne||(Ne={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(xt||(xt={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Lt||(Lt={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension",e[e.esriGraphPropertyProvenanceInstanceId=10]="esriGraphPropertyProvenanceInstanceId",e[e.esriGraphPropertyProvenanceSourceType=11]="esriGraphPropertyProvenanceSourceType",e[e.esriGraphPropertyProvenanceSourceName=12]="esriGraphPropertyProvenanceSourceName",e[e.esriGraphPropertyProvenanceSource=13]="esriGraphPropertyProvenanceSource",e[e.esriGraphPropertyProvenanceComment=14]="esriGraphPropertyProvenanceComment",e[e.esriGraphPropertyProvenanceTypeName=15]="esriGraphPropertyProvenanceTypeName",e[e.esriGraphPropertyProvenancePropertyName=16]="esriGraphPropertyProvenancePropertyName"}(Ot||(Ot={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Ft||(Ft={}));var gr,At,qt,Le;(function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"})(gr||(gr={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(At||(At={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(qt||(qt={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(Le||(Le={}));function Go(e){const t=new Io;t.version=e.version;const r=e.get_query_result();if(r.results_type.value!==0)throw new Error("Got a non-feature collection type");const n=r.get_feature_result(),o=t.queryResult.featureResult;o.objectIdFieldName=n.objectid_field_name,o.exceededTransferLimit=n.exceeded_transfer_limit,o.hasM=n.has_m,o.hasZ=n.has_z,o.geometryType=Ne[n.geometry_type.value],o.globalIdFieldName=n.globalid_field_name,o.geohashFieldName=n.geohash_field_name;const i=o.uniqueIdField,a=n.unique_id_field;i.name=a.name,i.isSystemMaintained=a.isSystemMaintained;const l=o.geometryProperties,u=n.geometry_properties;l.shapeAreaFieldName=u.shapeAreaFieldName,l.shapeLengthFieldName=u.shapeLengthFieldName,l.units=u.units;const c=o.spatialReference,y=n.spatial_reference;c.wkid=y.wkid,c.latestWkid=y.latestWkid,c.vcsWkid=y.vcsWkid,c.latestVcsWkid=y.latestVcsWkid,c.wkt=y.wkt,o.transform=xo(n.transform);const d=o.fields,h=o.fieldNameToAttributeIndexMap,f=n.fields,g=f.size();for(let R=0;R<g;R++){const N=f.get(R),P=Kr(N);d.push(P),h[P.name]=R,N.delete()}f.delete();const I=o.values,v=n.values_count();for(let R=0;R<v;R++)I.push(n.get_value_at(R));const m=o.features,_=n.features,M=_.size();if(M>0){for(const R of jo)if(h[R]===void 0)throw new Error(`Feature collection missing required attribute: ${R}`)}for(let R=0;R<M;R++){const N=new Po,P=_.get(R),Q=N.attributes,q=P.attributes_count();for(let $=0;$<q;$++)Q.push(P.get_attribute_at($));const Y=P.get_compressed_geometry();Y&&(N.compressedGeometry=St(Y),N.centroid=St(P.get_centroid()));const ne=N.aggregateGeometries,V=P.aggregate_geometries,ce=V.size();for(let $=0;$<ce;$++){const E=V.get($),C=St(E);ne.push(C),E.delete()}V.delete(),m.push(N),P.delete()}_.delete();const G=o.geometryFields,A=n.geometry_fields,k=A.size();for(let R=0;R<k;R++){const N=A.get(R),P=Co(N);G.push(P),N.delete()}return A.delete(),t}function St(e){const t=new Gt;t.geometryType=Ne[e.geometry_type.value];const r=[],n=[];for(let o=0;o<e.lengths.length;o++)r.push(e.lengths[o]);for(let o=0;o<e.coords.length;o++)n.push(e.coords[o]);return t.lengths=r,t.coords=n,t}function Kr(e){const t=new Do;return t.name=e.name,t.alias=e.alias,t.fieldType=ot[e.field_type.value],t.sqlType=qt[e.sql_type.value],t.domain=e.domain,t.defaultValue=e.default_value,t}function Co(e){const t=Kr(e);return t.geometryType=Ne[e.geometry_type.value],t}function xo(e){const t=new Wr;t.quantizeOriginPosition=At[e.quantizeOriginPosition.value];const r=t.scale,n=e.scale;r.xScale=n.xScale,r.yScale=n.yScale,r.mScale=n.mScale,r.zScale=n.zScale;const o=t.translate,i=e.translate;return o.xTranslate=i.xTranslate,o.yTranslate=i.yTranslate,o.mTranslate=i.mTranslate,o.zTranslate=i.zTranslate,t}async function Lo(e){const t=[],r={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(wr(e.entitiesUrl).then(n=>{_r(n,r)})),e.relationshipsUrl&&t.push(wr(e.relationshipsUrl).then(n=>{_r(n,r)})),await Promise.all(t),r}async function xa(e,t){t??(t=!1);const r={generateAllSublayers:t,namedTypeDefinitions:new Map};return await Ao(e).then(n=>{Uo(n,r)}),r}async function La(e){const t=await re(),r=new t.MapOfObjectIdentifierSets;Oo(r,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(r),n.encode();const o=n.get_encoding_result();if(o.error.error_code!==0)throw new w("knowledge-graph:layer-support-utils",o.error.error_message);const i=structuredClone(o.get_byte_buffer());return n.delete(),i}finally{r.delete()}}function Oo(e,t,r){for(const[n,o]of r.namedTypeDefinitions){if(!o.members||o.useAllData)continue;const i=o.members.keys();let a=!1,l=!0;const u=new t.ObjectIdArray,c=new t.StringArray,y=new t.GlobalIdArray,d=new t.IdentifierArray,h=new t.ObjectIdentifierSet;for(const f of i)l&&(a=!isNaN(Number(f)),l=!1),a?u.add_objectid(Number(f)):(c.add_string(f),y.add_globalid(f)),d.add_identifier(f);h.set_oid_array(u),h.set_string_array(c),h.set_globalid_array(y),h.set_identifier_array(d),u.delete(),c.delete(),y.delete(),d.delete(),e.put_identifier_set(n,h),h.delete()}return e}async function wr(e){const t=await W(e,{responseType:"array-buffer"});return Fo(await t.data)}async function Fo(e){const t=new(await re()).FeatureCollectionDecoder,r=t.decode(new Uint8Array(e));if(r.error_code!==0)throw new w("knowledge-graph:layer-support-utils",r.error_message);const n=t.get_feature_collection(),o=Go(n);return t.delete(),o}async function Ao(e){const t=await W(e,{responseType:"array-buffer"}),r=await t.data;return qo(new Uint8Array(r))}async function qo(e){const t=new(await re()).MapOfObjectIdentifierSetsDecoder,r=t.decode(new Uint8Array(e)),n=new Map;if(r.error_code!==0)throw new w("knowledge-graph:layer-support-utils",r.error_message);const o=t.get_map_of_identifier_sets(),i=o.keys,a=i.size();for(let l=0;l<a;l++){const u=i.get(l),c=o.query_identifier_set(u),y=[];if(c.id_array_type.value===Le.GLOBALID_ARRAY){const d=c.get_globalid_array(),h=d.count();for(let f=0;f<h;f++)y.push(d.get_globalid_at(f))}else if(c.id_array_type.value===Le.IDENTIFIER_ARRAY){const d=c.get_identifier_array(),h=d.count();for(let f=0;f<h;f++)y.push(d.get_identifier_at(f).toString())}else if(c.id_array_type.value===Le.STRING_ARRAY){const d=c.get_string_array(),h=d.count();for(let f=0;f<h;f++)y.push(d.get_string_at(f))}else{if(c.id_array_type.value!==Le.OID_ARRAY)throw new w("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const d=c.get_oid_array(),h=d.count();for(let f=0;f<h;f++)y.push(d.get_objectid_at(f).toString())}}n.set(u,y)}return t.delete(),n}function _r(e,t){var n,o,i;if(!((n=e==null?void 0:e.queryResult)!=null&&n.featureResult))return t;const r=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const a of e.queryResult.featureResult.features){const l=a.attributes[r[qe.TYPENAME]],u=fe(t.namedTypeDefinitions,l,()=>({useAllData:!1,members:new Map})),c=a.attributes[r[qe.ELEMENTUID]];if(((i=(o=a.compressedGeometry)==null?void 0:o.coords)==null?void 0:i.length)>0){let y=a.compressedGeometry.lengths;a.compressedGeometry.geometryType==="esriGeometryPoint"&&(y=[]),u.members.set(c,{id:c,linkChartLocation:new In(y,a.compressedGeometry.coords)})}else u.members.set(c,{id:c})}return t}function Uo(e,t){for(const[r,n]of e){const o=fe(t.namedTypeDefinitions,r,()=>({useAllData:!1,members:new Map}));for(const i of n)o.members.has(i)||o.members.set(i,{id:i})}return t}const Oa={fetchAndConvertSerializedLinkChart:e=>Lo(e)};let $t=class Ee{constructor(){this._featureLookup=new Map}static getInstance(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}static resetInstance(){Ee.instance&&(Ee.instance=null)}deleteFromStore(t){t.forEach(r=>{this._featureLookup.delete(r)})}readFromStoreByList(t){const r=[];return t.forEach(n=>{const o=this.readFromStoreById(n);o&&r.push(o)}),r}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,r,n){const o=[];return t.forEach(i=>{if(!(i!=null&&i.id))return;i.properties||(i.properties=[]);let a,l=null;if(n&&i.properties[n]&&(l=ho(i.properties[n])),"originId"in i&&"destinationId"in i&&(i.properties[ft]=i.originId,i.properties[mt]=i.destinationId),i.properties[r]=i.id,i.id&&this._featureLookup.has(i.id)&&this._featureLookup.get(i.id).attributes){const u=this._featureLookup.get(i.id),c=JSON.parse(JSON.stringify(Object.assign(u.attributes,i.properties)));n&&i.properties[n]&&(c[n]=En(i.properties[n])),a=new sr(l?JSON.parse(JSON.stringify(l)):u!=null&&u.geometry?JSON.parse(JSON.stringify(u.geometry)):null,c,null,i.properties[r])}else a=new sr(l?JSON.parse(JSON.stringify(l)):null,i.properties,null,i.properties[r]);this._featureLookup.set(`${i.typeName?`${i.typeName}__${i.id}`:i.id}`,a),o.push(a)}),o}},Rt,S=null;function Fa(){return Rt||(Rt=nt(()=>import("./lclayout-jnpuPyOe.js"),__vite__mapDeps([3,1])).then(e=>e.l).then(({default:e})=>e({locateFile:t=>Pt(`esri/libs/linkchartlayout/${t}`)})).then(e=>{zo(e)}),Rt)}function zo(e){S=e}var br,me,Tr,gt;(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot",e[e.IsOld=8]="IsOld"})(br||(br={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.Canceled=2]="Canceled"}(me||(me={})),function(e){e[e.Regular=0]="Regular",e[e.Curved=1]="Curved",e[e.Recursive=2]="Recursive"}(Tr||(Tr={})),function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom"}(gt||(gt={}));const vr={none:0,"start-only":1,"start-and-end":2};function Jo(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...(e==null?void 0:e.toJSON())??{},eventsTicksVisualization:(e==null?void 0:e.eventsTicksVisualization)??"start-and-end"};return{...t,timeDirection:{value:gt[t.timeDirection]??gt.right},eventsTicksVisualization:{value:vr[t.eventsTicksVisualization]??vr["start-and-end"]}}}function ve(e,t,r,n,o,i){const a=r.length,l=o.length,u=Float64Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,y=Uint8Array.BYTES_PER_ELEMENT,d=16,h=d+a*(y+2*u)+l*(2*c),f=S._malloc(h);try{const g=f+d-f%d,I=g+a*u,v=I+a*u,m=v+l*c,_=m+l*c,M=()=>[S.HEAPF64.subarray(g>>3,(g>>3)+a),S.HEAPF64.subarray(I>>3,(I>>3)+a),S.HEAPU32.subarray(v>>2,(v>>2)+l),S.HEAPU32.subarray(m>>2,(m>>2)+l),S.HEAPU8.subarray(_,_+a)],[G,A,k,R,N]=M();G.set(r),A.set(n),k.set(o),R.set(i),N.set(t);const P=e(a,_,g,I,l,v,m);let Q=null,q=null;if(P.value===me.Success){const E=S.getLayoutLinksTypes(),C=S.getLayoutLinksVerticesEndIndices(),F=S.getLayoutLinksVertices(),x=S.countLayoutLinksVertices();!l||E&&C?x&&!F?P.value=me.Error:(Q={types:new Uint8Array(S.HEAPU8.subarray(E,E+l)),vertexEndIndex:new Uint32Array(S.HEAPU32.subarray(C>>2,(C>>2)+l)),vertices:new Float64Array(S.HEAPF64.subarray(F>>3,(F>>3)+2*x))},q=S.getAuxiliaryGraphicElements()):P.value=me.Error}const[Y,ne,V,ce,$]=M();return r.set(Y),n.set(ne),o.set(V),i.set(ce),t.set($),{status:P.value,links:Q,graphics:q}}finally{S._free(f),S.cleanupLayout()}}const Ir=2,Er=1,Sr=-1;var $r,Rr,Nr,Mr,Dr,Pr,jr,kr,Gr;(function(e){function t(){return S.getMinIdealEdgeLength()}function r(n,o,i,a,l,u,c=Ir,y=Er,d=Sr){return ve((h,f,g,I,v,m,_)=>S.applyForceDirectedLayout(n,h,f,g,I,v,m,_,c,y,d),o,i,a,l,u)}e.getMinIdealEdgeLength=t,e.apply=r})($r||($r={})),function(e){function t(r,n,o,i,a,l,u=Ir,c=Er,y=Sr){return ve((d,h,f,g,I,v,m)=>S.applyCommunityLayout(r,d,h,f,g,I,v,m,u,c,y),n,o,i,a,l)}e.apply=t}(Rr||(Rr={})),function(e){function t(r,n,o,i,a,l){return ve((u,c,y,d,h,f,g)=>S.applySimpleLayout(r,u,c,y,d,h,f,g),n,o,i,a,l)}e.apply=t}(Nr||(Nr={})),function(e){function t(r,n,o,i,a,l){return ve((u,c,y,d,h,f,g)=>S.applyHierarchicalLayout(r,u,c,y,d,h,f,g),n,o,i,a,l)}e.apply=t}(Mr||(Mr={})),function(e){function t(r,n,o,i,a,l){return ve((u,c,y,d,h,f,g)=>S.applyRadialTreeLayout(r,u,c,y,d,h,f,g),n,o,i,a,l)}e.apply=t}(Dr||(Dr={})),function(e){function t(r,n,o,i,a,l){return ve((u,c,y,d,h,f,g)=>S.applySmartTreeLayout(r,u,c,y,d,h,f,g),n,o,i,a,l)}e.apply=t}(Pr||(Pr={})),function(e){function t(r,n,o,i,a,l,u,c,y,d,h,f){return ve((g,I,v,m,_,M,G)=>{if(a.length!==g)return{value:me.Error};if(l.length!==g)return{value:me.Error};if(y.length!==_)return{value:me.Error};if(d.length!==_)return{value:me.Error};const A=Float64Array.BYTES_PER_ELEMENT,k=16,R=S._malloc(k+g*A),N=S._malloc(k+g*A),P=S._malloc(k+_*A),Q=S._malloc(k+_*A),q=R+k-R%k,Y=N+k-N%k,ne=P+k-P%k,V=Q+k-Q%k;try{return S.HEAPF64.subarray(q>>3,(q>>3)+g).set(a),S.HEAPF64.subarray(Y>>3,(Y>>3)+g).set(l),S.HEAPF64.subarray(ne>>3,(ne>>3)+_).set(y),S.HEAPF64.subarray(V>>3,(V>>3)+_).set(d),S.applyChronologicalLayout(r,g,I,v,m,q,Y,_,M,G,ne,V,h,Jo(f))}finally{S._free(R),S._free(N),S._free(P),S._free(Q)}},n,o,i,u,c)}e.apply=t}(jr||(jr={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(kr||(kr={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Gr||(Gr={}));Kt()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"});Kt()({absoluteValue:"absolute-value",multiplier:"multiplier"});const Bo=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var Ut;let ue=Ut=class extends Me{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return Sn(Ut,e)}};s([p({type:de})],ue.prototype,"outSpatialReference",void 0),s([p({type:Fe})],ue.prototype,"processExtent",void 0),s([p({type:de})],ue.prototype,"processSpatialReference",void 0),s([p({nonNullable:!0})],ue.prototype,"returnColumnName",void 0),s([p({nonNullable:!0})],ue.prototype,"returnFeatureCollection",void 0),s([p({nonNullable:!0})],ue.prototype,"returnM",void 0),s([p({nonNullable:!0})],ue.prototype,"returnZ",void 0),ue=Ut=s([j("esri.rest.geoprocessor.GPOptions")],ue);const Zr=ue;let se=class extends K{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};s([p({type:Fe})],se.prototype,"extent",void 0),s([p()],se.prototype,"height",void 0),s([p()],se.prototype,"href",void 0),s([p()],se.prototype,"opacity",void 0),s([p()],se.prototype,"rotation",void 0),s([p()],se.prototype,"scale",void 0),s([p()],se.prototype,"visible",void 0),s([p()],se.prototype,"width",void 0),se=s([j("esri.layers.support.MapImage")],se);const Vo=se;let Be=class extends K{constructor(t){super(t),this.area=0,this.units=null}};s([p({json:{write:!0}})],Be.prototype,"area",void 0),s([bt(bo)],Be.prototype,"units",void 0),Be=s([j("esri.rest.support.ArealUnit")],Be);const Ho=Be;let Ve=class extends K{constructor(t){super(t),this.itemId=null,this.url=null}};s([p({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],Ve.prototype,"itemId",void 0),s([p({type:String,json:{write:!0}})],Ve.prototype,"url",void 0),Ve=s([j("esri.rest.support.DataFile")],Ve);const Nt=Ve;let He=class extends K{constructor(t){super(t),this.distance=0,this.units=null}};s([p({json:{write:!0}})],He.prototype,"distance",void 0),s([bt(To)],He.prototype,"units",void 0),He=s([j("esri.rest.support.LinearUnit")],He);const Qo=He,B="multi-value-",tr=new $n({GPArealUnit:"areal-unit",GPBoolean:"boolean",GPComposite:"composite",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPArealUnit":`${B}areal-unit`,"GPMultiValue:GPBoolean":`${B}boolean`,"GPMultiValue:GPComposite":`${B}composite`,"GPMultiValue:GPDataFile":`${B}data-file`,"GPMultiValue:GPDate":`${B}date`,"GPMultiValue:GPDouble":`${B}double`,"GPMultiValue:GPFeatureRecordSetLayer":`${B}feature-record-set-layer`,"GPMultiValue:Field":`${B}field`,"GPMultiValue:GPLinearUnit":`${B}linear-unit`,"GPMultiValue:GPLong":`${B}long`,"GPMultiValue:GPRasterData":`${B}raster-data`,"GPMultiValue:GPRasterDataLayer":`${B}raster-data-layer`,"GPMultiValue:GPRecordSet":`${B}record-set`,"GPMultiValue:GPString":`${B}string`});let je=class extends K{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};s([bt(tr,{ignoreUnknown:!1})],je.prototype,"dataType",void 0),s([p()],je.prototype,"paramName",void 0),s([p()],je.prototype,"value",void 0),je=s([j("esri.rest.support.ParameterValue")],je);const Yo=je;let ke=class extends K{constructor(t){super(t),this.format=null,this.itemId=null,this.url=null}};s([p()],ke.prototype,"format",void 0),s([p({json:{read:{source:"itemID"},write:{target:"itemID"}}})],ke.prototype,"itemId",void 0),s([p()],ke.prototype,"url",void 0),ke=s([j("esri.rest.support.RasterData")],ke);const Wo=ke;async function Ko(e,t,r,n,o){const i={},a={},l=[];return Zo(n,l,i),Rn(l).then(u=>{const{outSpatialReference:c,processExtent:y,processSpatialReference:d,returnColumnName:h,returnFeatureCollection:f,returnM:g,returnZ:I}=r,{path:v}=De(e);for(const k in i){const[R,N]=i[k];a[k]=u.slice(R,N)}const m=c?c.wkid||c:null,_=d?d.wkid||d:null,M=null,G=wt({...y?{context:{extent:y,outSR:m,processSR:_}}:{"env:outSR":m,"env:processSR":_},...n,...M,f:"json"},null,a),A={...o,query:G};return W(`${v}/${t}`,A)})}function Zo(e,t,r){for(const n in e){const o=e[n];if(o&&typeof o=="object"&&o instanceof ht){const{features:i}=o;r[n]=[t.length,t.length+i.length],i.forEach(a=>{t.push(a.geometry)})}}}async function zt(e,t){switch(e){case"areal-unit":return Ho.fromJSON(t);case"boolean":case"double":case"long":case"string":case"value-table":return t;case"date":return new Date(t);case"data-file":return Nt.fromJSON(t);case"linear-unit":return Qo.fromJSON(t);case"feature-record-set-layer":if("url"in t)return Nt.fromJSON(t);if("layerDefinition"in t){const r=new(await nt(async()=>{const{default:i}=await import("./index-Byn_dG8u.js").then(a=>a.xg);return{default:i}},__vite__mapDeps([4,5]))).default,{layerDefinition:n,featureSet:o}=t;return r.read({layerDefinition:n,featureSet:o},{origin:"portal-item"}),r.spatialReference=de.fromJSON(o.spatialReference??n.spatialReference??n.extent.spatialReference),r}return ht.fromJSON(t);case"record-set":return"url"in t?Nt.fromJSON(t):ht.fromJSON(t);case"raster-data":case"raster-data-layer":return"mapImage"in t?Vo.fromJSON(t.mapImage):Wo.fromJSON(t);case"field":return ze.fromJSON(t)}}function Xo(e){return e.startsWith(B)}function ei(e){return e.replace(B,"")}async function ti(e,t){const r=ei(e),n=r==="composite"?t.map(o=>zt(tr.fromJSON(o.dataType),o.value)):t.map(o=>zt(r,o));return Promise.all(n)}async function Cr(e){const t=tr.fromJSON(e.dataType),{paramName:r}=e,n=Xo(t)?await ti(t,e.value):await zt(t,e.value);return new Yo({dataType:t,paramName:r,value:n})}function wt(e,t,r){for(const n in e){const o=e[n];Array.isArray(o)?e[n]=JSON.stringify(o.map(i=>wt({item:i},!0).item)):o instanceof Date&&(e[n]=o.getTime())}return Nn(e,t,r)}var ct;const ri=Kt()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1}),Mt=1e3;let ye=ct=class extends K{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._cancelJobTimer=void 0,this._jobCompletionTimer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:r}=this,{path:n}=De(r),o={...this.requestOptions,...e,query:{f:"json"}},i=`${n}/jobs/${t}/cancel`,{data:a}=await W(i,o),{messages:l,jobStatus:u,progress:c}=ct.fromJSON(a);return this.set({messages:l,jobStatus:u,progress:c}),u==="job-cancelled"?this:new Promise((y,d)=>{lr(o.signal,()=>{this.clearCancelJobTimer(),d(Je())}),this.clearCancelJobTimer();const h=()=>{this._cancelJobTimer||d(Je()),this.checkJobStatus(e).then(({jobStatus:f})=>{switch(f){case"job-cancelling":default:this._cancelJobTimer=setTimeout(h,Mt);break;case"job-deleted":case"job-deleting":case"job-executing":case"job-failed":case"job-new":case"job-submitted":case"job-succeeded":case"job-timed-out":case"job-waiting":d(this);break;case"job-cancelled":y(this)}})};this._cancelJobTimer=setTimeout(h,Mt)})}destroy(){clearInterval(this._cancelJobTimer),clearInterval(this._jobCompletionTimer)}async checkJobStatus(e){const{path:t}=De(this.sourceUrl),r={...this.requestOptions,...e,query:{f:"json"}},n=`${t}/jobs/${this.jobId}`,{data:o}=await W(n,r),{messages:i,jobStatus:a,progress:l}=ct.fromJSON(o);return this.set({messages:i,jobStatus:a,progress:l}),this}async fetchResultData(e,t,r){t=Zr.from(t||{});const{returnColumnName:n,returnFeatureCollection:o,returnM:i,returnZ:a,outSpatialReference:l}=t,{path:u}=De(this.sourceUrl),c=wt({returnColumnName:n||null,returnFeatureCollection:o||null,returnM:i||null,returnZ:a||null,outSR:l,returnType:"data",f:"json"},null),y={...this.requestOptions,...r,query:c},d=`${u}/jobs/${this.jobId}/results/${e}`,{data:h}=await W(d,y);return Cr(h)}async fetchResultImage(e,t,r){const{path:n}=De(this.sourceUrl),o={...t.toJSON(),f:"json"},i=wt(o),a={...this.requestOptions,...r,query:i},l=`${n}/jobs/${this.jobId}/results/${e}`,{data:u}=await W(l,a);return Cr(u)}async fetchResultMapImageLayer(){const{path:e}=De(this.sourceUrl),t=e.indexOf("/GPServer/"),r=`${e.slice(0,Math.max(0,t))}/MapServer/jobs/${this.jobId}`;return new(await nt(async()=>{const{default:n}=await import("./MapImageLayer-DpazwgTT.js");return{default:n}},__vite__mapDeps([6,4,5,7,8,9,10,11]))).default({url:r})}async waitForJobCompletion(e={}){const{interval:t=Mt,signal:r,statusCallback:n}=e;return new Promise((o,i)=>{lr(r,()=>{this.clearJobCompletionTimer(),i(Je())}),this.clearJobCompletionTimer();const a=()=>{this._jobCompletionTimer||i(Je()),this.checkJobStatus().then(({jobStatus:l})=>{switch(l){case"job-succeeded":o(this);break;case"job-executing":case"job-new":case"job-submitted":case"job-waiting":n&&n(this),this._jobCompletionTimer=setTimeout(a,t);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-failed":case"job-timed-out":i(this);break;default:this._jobCompletionTimer=setTimeout(a,t)}}).catch(l=>{i(l)})};this._jobCompletionTimer=setTimeout(a,t)})}clearCancelJobTimer(){clearTimeout(this._cancelJobTimer),this._cancelJobTimer=void 0}clearJobCompletionTimer(){clearTimeout(this._jobCompletionTimer),this._jobCompletionTimer=void 0}};s([p()],ye.prototype,"jobId",void 0),s([bt(ri,{ignoreUnknown:!1})],ye.prototype,"jobStatus",void 0),s([p({type:[vo]})],ye.prototype,"messages",void 0),s([p()],ye.prototype,"progress",void 0),s([p()],ye.prototype,"requestOptions",void 0),s([p({json:{write:!0}})],ye.prototype,"sourceUrl",void 0),ye=ct=s([j("esri.rest.support.JobInfo")],ye);const ni=ye;async function oi(e,t,r,n){return r=Zr.from(r||{}),Ko(e,"submitJob",r,t??{},n).then(({data:o})=>{const i=ni.fromJSON(o);return i.sourceUrl=e,i})}let Ge=class extends Me{constructor(t){super(t),this.headerKeys=[],this.outSpatialReference=null,this.exceededTransferLimit=!1}};s([p()],Ge.prototype,"headerKeys",void 0),s([p()],Ge.prototype,"outSpatialReference",void 0),s([p()],Ge.prototype,"exceededTransferLimit",void 0),Ge=s([j("esri.rest.knowledgeGraph.GraphQueryResultHeader")],Ge);const vt=Ge;let Qe=class extends Me{constructor(t){super(t),this.resultRows=[],this.resultHeader=new vt}};s([p()],Qe.prototype,"resultRows",void 0),s([p()],Qe.prototype,"resultHeader",void 0),Qe=s([j("esri.rest.knowledgeGraph.GraphQueryResult")],Qe);const xr=Qe;let Ye=class extends Me{constructor(t){super(t),this.resultRowsStream=new ReadableStream,this.resultHeader=new vt}};s([p()],Ye.prototype,"resultRowsStream",void 0),s([p()],Ye.prototype,"resultHeader",void 0),Ye=s([j("esri.rest.knowledgeGraph.GraphQueryStreamingResult")],Ye);const Lr=Ye;let _e=class extends K{constructor(t){super(t),this.name=null,this.unique=null,this.ascending=!0,this.description="",this.fieldNames=[]}};s([p({type:String,json:{write:!0}})],_e.prototype,"name",void 0),s([p({type:Boolean,json:{write:!0}})],_e.prototype,"unique",void 0),s([p({type:Boolean,json:{write:!0}})],_e.prototype,"ascending",void 0),s([p({type:String,json:{write:!0}})],_e.prototype,"description",void 0),s([p({type:[String],json:{write:!0}})],_e.prototype,"fieldNames",void 0),_e=s([j("esri.rest.knowledgeGraph.FieldIndex")],_e);const Xr=_e;let J=class extends K{constructor(t){super(t),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=!0,this.required=!1,this.defaultVisibility=!0,this.systemMaintained=null,this.role="esriGraphPropertyUNSPECIFIED",this.defaultValue=null}};s([p({type:String,json:{write:!0}})],J.prototype,"name",void 0),s([p({type:String,json:{write:!0}})],J.prototype,"alias",void 0),s([p({type:String,json:{write:!0}})],J.prototype,"fieldType",void 0),s([p({type:String,json:{write:!0}})],J.prototype,"geometryType",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"hasM",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"hasZ",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"nullable",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"editable",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"required",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"defaultVisibility",void 0),s([p({type:Boolean,json:{write:!0}})],J.prototype,"systemMaintained",void 0),s([p({type:String,json:{write:!0}})],J.prototype,"role",void 0),s([p({json:{write:!0}})],J.prototype,"defaultValue",void 0),J=s([j("esri.rest.knowledgeGraph.GraphProperty")],J);const en=J;let he=class extends K{constructor(t){super(t),this.name=null,this.alias=null,this.role="Regular",this.strict=null,this.properties=[],this.fieldIndexes=[],this.type=null}};s([p({type:String,json:{write:!0}})],he.prototype,"name",void 0),s([p({type:String,json:{write:!0}})],he.prototype,"alias",void 0),s([p({type:String,json:{write:!0}})],he.prototype,"role",void 0),s([p({type:Boolean,json:{write:!0}})],he.prototype,"strict",void 0),s([p({type:[en],json:{write:!0}})],he.prototype,"properties",void 0),s([p({type:[Xr],json:{write:!0}})],he.prototype,"fieldIndexes",void 0),he=s([j("esri.rest.knowledgeGraph.GraphObjectType")],he);const tn=he;let Jt=class extends tn{constructor(t){super(t),this.type="entity"}};Jt=s([j("esri.rest.knowledgeGraph.EntityType")],Jt);const Bt=Jt;let yt=class extends tn{constructor(t){super(t),this.endPoints=[],this.type="relationship"}};s([p({json:{write:!0}})],yt.prototype,"endPoints",void 0),yt=s([j("esri.rest.knowledgeGraph.RelationshipType")],yt);const rn=yt;let We=class extends K{constructor(t){super(t),this.value=null,this.behavior=null}};s([p({type:String,json:{write:!0}})],We.prototype,"value",void 0),s([p({type:String,json:{write:!0}})],We.prototype,"behavior",void 0),We=s([j("esri.rest.knowledgeGraph.SourceTypeValueBehavior")],We);const nn=We;let H=class extends K{constructor(t){super(t),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=[],this.entityTypes=[],this.relationshipTypes=[],this.metaEntityTypes=[],this.provenanceSourceTypeValues=[]}};s([p({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e==null?void 0:e.getTime()}}}})],H.prototype,"timestamp",void 0),s([p({type:de,json:{write:!0}})],H.prototype,"spatialReference",void 0),s([p({type:Boolean,json:{write:!0}})],H.prototype,"strict",void 0),s([p({type:String,json:{write:!0}})],H.prototype,"objectIdField",void 0),s([p({type:String,json:{write:!0}})],H.prototype,"globalIdField",void 0),s([p()],H.prototype,"arcgisManaged",void 0),s([p()],H.prototype,"identifierInfo",void 0),s([p()],H.prototype,"searchIndexes",void 0),s([p({type:[Bt],json:{write:!0}})],H.prototype,"entityTypes",void 0),s([p({type:[rn],json:{write:!0}})],H.prototype,"relationshipTypes",void 0),s([p({type:[Bt],json:{write:!0}})],H.prototype,"metaEntityTypes",void 0),s([p({type:[nn],json:{write:!0}})],H.prototype,"provenanceSourceTypeValues",void 0),H=s([j("esri.rest.knowledgeGraph.DataModel")],H);const on=H;let O=class extends K{constructor(t){super(t),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1,this.supportsProvenance=!1}};s([p({type:[String],json:{write:!0}})],O.prototype,"capabilities",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"supportsSearch",void 0),s([p({type:[String],json:{write:!0}})],O.prototype,"supportedQueryFormats",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"allowGeometryUpdates",void 0),s([p({type:Number,json:{write:!0}})],O.prototype,"searchMaxRecordCount",void 0),s([p({type:Object,json:{write:!0}})],O.prototype,"serviceCapabilities",void 0),s([p({type:Number,json:{write:!0}})],O.prototype,"maxRecordCount",void 0),s([p({type:String,json:{write:!0}})],O.prototype,"description",void 0),s([p({type:String,json:{write:!0}})],O.prototype,"copyrightText",void 0),s([p({type:String,json:{write:!0}})],O.prototype,"units",void 0),s([p({type:de,json:{write:!0}})],O.prototype,"spatialReference",void 0),s([p({type:Number,json:{write:!0}})],O.prototype,"currentVersion",void 0),s([p({type:Object,json:{write:!0}})],O.prototype,"dateFieldsTimeReference",void 0),s([p({type:String,json:{write:!0}})],O.prototype,"serviceItemId",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"supportsDocuments",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"dataEditingNotSupported",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"schemaEditingNotSupported",void 0),s([p({type:Boolean,json:{write:!0}})],O.prototype,"supportsProvenance",void 0),O=s([j("esri.rest.knowledgeGraph.ServiceDefinition")],O);const an=O;let Ce=class extends K{constructor(t){super(t),this.url=null,this.dataModel=null,this.serviceDefinition=null}};s([p({type:String,json:{write:!0}})],Ce.prototype,"url",void 0),s([p({type:on,json:{write:!0}})],Ce.prototype,"dataModel",void 0),s([p({type:an,json:{write:!0}})],Ce.prototype,"serviceDefinition",void 0),Ce=s([j("esri.rest.knowledgeGraph.KnowledgeGraph")],Ce);const ii=Ce;function Te(e,t,r){if(e.error_code!==0)throw new w(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function ai(e,t,r,n=!1){const o=new r.ClientDataFetchRequestEncoder;o.deleteLater();for(const a of e){const l=si(a,t,r,n);o.add_client_data_fetch_request_parameter(l)}o.encode();const i=o.get_encoding_result();return Te(i.error,"knowledge-graph:fetchClientDataAtKeys-encoding-failed","Attempting to encode the fetchClientDataAtKeys failed"),structuredClone(i.get_byte_buffer())}function si(e,t,r,n){const o=new r.ClientDataKey;o.deleteLater(),o.key_string=e;const i=new r.ClientDataFetchRequestParameter;i.deleteLater(),i.set_key(o);const a=t.get(e);return a&&!n&&(i.v_tag={v_tag:a.version}),i}var $e,Or,Vt;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})($e||($e={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(Or||(Or={})),function(e){e[e.exclude=0]="exclude",e[e.include=1]="include"}(Vt||(Vt={}));function sn(e,t){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(nr(n,t))}),r}function ln(e,t){const r=new t.ObjectValue;r.deleteLater();for(const[n,o]of Object.entries(e))r.set_key_value(n,nr(o,t));return r}function rr(e,t){if(e instanceof Hr)return ci(e,t);if(e instanceof Xt)return yi(e,t);if(e instanceof Tt||e instanceof it)return di(e,t);throw new w("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function li(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function pi(e,t,r){if(!e.extent)throw new w("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new w("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new w("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function ui(e,t){t.provenance_behavior={value:Vt[e]}}function nr(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof Zt)return rr(e,t);if(Array.isArray(e)){const r=new t.ArrayValue;return r.deleteLater(),e.forEach(n=>{r.add_value(nr(n,t))}),r}return ln(e,t)}function di(e,t){const r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],o=[];let i=[];e instanceof Tt?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,i=e.paths):e instanceof it&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,i=e.rings);let a=0,l=0;return i.forEach(u=>{let c=0;u.forEach(y=>{c++,y.forEach(d=>{n[l]=d,l++})}),o[a]=c,a++}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(o),r}function ci(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],o=[];o[0]=e.points.length;let i=0;return e.points.forEach(a=>{a.forEach(l=>{n[i]=l,i++})}),r.coords=new Float64Array(n),r.lengths=new Uint32Array(o),r}function yi(e,t){const r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;const n=[],o=[];o[0]=1,n[0]=e.x,n[1]=e.y;let i=2;return e.hasZ&&(n[i]=e.z,i++),e.hasM&&(n[i]=e.m,i++),r.coords=new Float64Array(n),r.lengths=new Uint32Array(o),r}function lt(e,t){if(!e.typeName)throw new w("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Qr){const r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,o]of Object.entries(e.properties))r.set_key_value(n,Fr(o,t));return e.id&&r.set_id(e.id),r}if(e instanceof Yr){const r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(const[n,o]of Object.entries(e.properties))r.set_key_value(n,Fr(o,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new w("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function hi(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Fr(e,t){return e==null?null:typeof e!="object"||e instanceof Date?e:e instanceof Zt?rr(e,t):null}var Ht,Ar,_t,Qt;(function(e){e[e.ClientDataKeyTypeUNSPECIFIED=0]="ClientDataKeyTypeUNSPECIFIED",e[e.ClientDataKeyTypeString=1]="ClientDataKeyTypeString"})(Ht||(Ht={})),function(e){e[e.ClientDataTypeUNSPECIFIED=0]="ClientDataTypeUNSPECIFIED",e[e.ClientDataTypeString=1]="ClientDataTypeString"}(Ar||(Ar={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.ClientData=1]="ClientData",e[e.NotModified=2]="NotModified"}(_t||(_t={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Error=1]="Error",e[e.ClientDataValue=2]="ClientDataValue"}(Qt||(Qt={}));function fi(e,t,r,n=!1){const o=new Map;for(let i=0;i<e.get_results_count();i++){const a=e.get_result_at(i);if(a.get_fetch_result_case().value!==Qt.ClientDataValue||a.error().error_code!==0){const d=a.get_key().key_string;r.has(d)&&t.delete(d);continue}const l=a.get_value(),u=a.get_key().key_string,c=r.get(u);let y;if(l.get_data_case().value===_t.NotModified&&c)y=c.value;else{if(l.get_data_case().value!==_t.ClientData)continue;{y=l.get_data().client_data_string;const d=a.get_value().get_v_tag().v_tag;n||t.set(u,{key:u,version:d,value:y})}}o.set(u,y)}return o}function mi(e){const t=e.get_keys(),r=new Array;for(let n=0;n<t.get_keys_count();n++){const o=t.get_key_at(n);o.get_client_data_key_type().value===Ht.ClientDataKeyTypeString&&r.push(o.key_string)}return r}let Se=class extends Me{constructor(t){super(t),this.name=null,this.supportedCategory="esriTypeUNSPECIFIED",this.analyzers=[],this.searchProperties=new Map}};s([p()],Se.prototype,"name",void 0),s([p()],Se.prototype,"supportedCategory",void 0),s([p()],Se.prototype,"analyzers",void 0),s([p()],Se.prototype,"searchProperties",void 0),Se=s([j("esri.rest.knowledgeGraph.SearchIndex")],Se);const gi=Se;let Yt=!1;function wi(e){var r,n,o,i,a,l,u,c,y,d,h;e.deleteLater(),Yt=!1;const t=new on({timestamp:e.timestamp,spatialReference:new de(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Ft[(o=(n=(r=e.identifier_info)==null?void 0:r.identifier_mapping_info)==null?void 0:n.identifier_info_type)==null?void 0:o.value],databaseNativeIdentifier:(a=(i=e.identifier_info)==null?void 0:i.identifier_mapping_info)==null?void 0:a.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:(c=(u=(l=e.identifier_info)==null?void 0:l.identifier_mapping_info)==null?void 0:u.uniform_property_identifier)==null?void 0:c.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:xt[(h=(d=(y=e.identifier_info)==null?void 0:y.identifier_generation_info)==null?void 0:d.uuid_method_hint)==null?void 0:h.value]}},searchIndexes:Mi(e.search_indexes),entityTypes:qr(e.entity_types),relationshipTypes:Ri(e.relationship_types),metaEntityTypes:qr(e.meta_entity_types),provenanceSourceTypeValues:Ni(e.provenance_source_type_values.value_behavior_array)});return Yt&&Ae.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),t}function _i(e){return e.deleteLater(),new Bt(pn(e))}function bi(e){return e.deleteLater(),new Xr({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Ei(e.fields)})}function pn(e){return{name:e.name,alias:e.alias,role:Ct[e.role.value],strict:e.strict,properties:Si(e.properties),fieldIndexes:$i(e.field_indexes)}}function Ti(e){return e.deleteLater(),new en({alias:e.alias,name:e.name,fieldType:ot[e.field_type.value]?ot[e.field_type.value]:void 0,geometryType:Ne[e.geometry_type.value]?Ne[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:Ot[e.role.value],defaultValue:e.default_value})}function vi(e){e.deleteLater();const t=pn(e),r=[];for(let n=0;n<e.end_points.size();n++){const o=e.end_points.get(n);r.push({originEntityType:o.origin_entity_type,destinationEntityType:o.dest_entity_type})}return e.end_points.delete(),new rn(Object.assign({endPoints:r},t))}function Ii(e){return new nn({behavior:e.behavior,value:e.value})}function qr(e){const t=[];for(let r=0;r<e.size();r++)t.push(_i(e.get(r)));return e.delete(),t}function Ei(e){const t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return e.delete(),t}function Si(e){const t=[];for(let r=0;r<e.size();r++){const n=Ti(e.get(r));n.fieldType==="esriFieldTypeBigInteger"&&(Yt=!0),t.push(n)}return e.delete(),t}function $i(e){const t=[];for(let r=0;r<e.size();r++)t.push(bi(e.get(r)));return e.delete(),t}function Ri(e){const t=[];for(let r=0;r<e.size();r++)t.push(vi(e.get(r)));return e.delete(),t}function Ni(e){const t=[];for(let r=0;r<e.size();r++){const n=e.get(r);n.deleteLater(),t.push(Ii(n))}return e.delete(),t}function Mi(e){const t=[];for(let r=0;r<e.size();r++){const n=new gi,o=e.get(0);n.name=o.name,n.supportedCategory=Lt[o.supported_category.value];const i=o.analyzers.size();for(let a=0;a<i;a++)n.analyzers.push({name:o.analyzers.get(a).name});o.analyzers.delete();for(let a=0;a<o.search_properties.keys().size();a++){const l=o.search_properties.keys().get(a),u=o.search_properties.get(l),c=[];for(let y=0;y<u.property_names.size();y++)c.push(u.property_names.get(y));n.searchProperties.set(l,{propertyNames:c})}t.push(n)}return e.delete(),t}var oe;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(oe||(oe={}));function Di(e,t){const r={spatialReference:t},n=or(e,r),o=e.lengths,i=e.coords,a=o[0];r.points=[];let l=0;for(let u=0;u<a;u++){const c=[];for(let y=0;y<n;y++)c[y]=i[l],l++;r.points.push(c)}return new Hr(r)}function Pi(e,t){const r={spatialReference:t};let n=2;or(e,r);const o=e.coords;return r.x=o[0],r.y=o[1],e.has_z&&(r.z=o[n],n++),e.has_m&&(r.m=o[n]),new Xt(r)}function ji(e,t){const{paths:r,hasM:n,hasZ:o}=un(e,oe.ESRI_GEOMETRY_POLYLINE);return new Tt({paths:r,hasM:n,hasZ:o,spatialReference:t})}function ki(e,t){const{paths:r,hasM:n,hasZ:o}=un(e,oe.ESRI_GEOMETRY_POLYGON);return new it({rings:r,hasM:n,hasZ:o,spatialReference:t})}function un(e,t){const r={paths:[],hasM:!1,hasZ:!1},n=or(e,r),{coords:o,geometry_type:i,lengths:a}=e;if(i.value!==t)throw new w("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");let l=0;return a.forEach(u=>{const c=[];for(let y=0;y<u;y++){const d=[];for(let h=0;h<n;h++)d[h]=o[l],l++;c.push(d)}r.paths.push(c)}),r}function or(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}const pt=()=>Ae.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),Gi={decodedWasmObjToQueryResponseObj:(e,t,r)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case oe.ESRI_GEOMETRY_POINT:return Pi(e,r);case oe.ESRI_GEOMETRY_MULTIPOINT:return Di(e,r);case oe.ESRI_GEOMETRY_POLYLINE:return ji(e,r);case oe.ESRI_GEOMETRY_POLYGON:return ki(e,r);case oe.ESRI_GEOMETRY_ENVELOPE:case oe.ESRI_GEOMETRY_MULTI_PATCH:return pt().warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case oe.ESRI_GEOMETRY_NULL:case oe.ESRI_GEOMETRY_ANY:default:return pt().warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return pt().warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case $e.OBJECT:return xi(e,t,r);case $e.ENTITY:return dn(e,t,r);case $e.RELATIONSHIP:return cn(e,t,r);case $e.PATH:return Li(e,t,r);case $e.ARRAY:return Ci(e,t,r);default:return pt().warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function Ci(e,t,r){const n=[],o=e.count();for(let i=0;i<o;i++){const a=e.get_value_at(i);n.push(ir(a,t,r))}return n}function ir(e,t,r){return Gi.decodedWasmObjToQueryResponseObj(e,t,r)}function dn(e,t,r){const n=e.type_name,o=ar(e,t,r),i=e.get_id();return new Qr(Object.assign({typeName:n,id:i},o))}function ar(e,t,r){const n={},o=e.key_count();for(let i=0;i<o;i++)n[e.get_key_at(i)]=ir(e.get_value_at(i),t,r);return{properties:n}}function xi(e,t,r){return new mo(ar(e,t,r))}function Li(e,t,r){const n=e.entity_count(),o=e.relationship_count(),i=[];for(let a=0;a<n;a++)i.push(dn(e.get_entity_at(a),t,r)),a<o&&i.push(cn(e.get_relationship_at(a),t,r));return new fo({path:i})}function cn(e,t,r){const n=e.type_name,o=ar(e,t,r);return new Yr(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},o))}function Oi(e){const t=[];for(let n=0;n<e.get_header_keys().size();n++)t.push(e.get_header_keys().get(n));const r=new de(e.get_out_sr());return new vt({headerKeys:t,outSpatialReference:r,exceededTransferLimit:e.exceeded_transfer_limit()})}let xe=class extends Me{constructor(t){super(t),this.hasError=!1,this.error=null,this.editResults=[]}};s([p()],xe.prototype,"hasError",void 0),s([p()],xe.prototype,"error",void 0),s([p()],xe.prototype,"editResults",void 0),xe=s([j("esri.rest.knowledgeGraph.GraphApplyEditsResult")],xe);const Fi=xe;function Ai(e){const t=e.has_error(),r=new Fi({hasError:t,error:t?{errorCode:e.error.error_code,errorMessage:e.error.error_message}:null}),n=e.get_edit_results_count();for(let o=0;o<n;o++){const i=e.get_edit_results_at(o),a=e.get_edit_results_type_name_at(o),l=[],u=[],c=[],y=i.get_add_results_count(),d=i.get_update_results_count(),h=i.get_delete_results_count();for(let f=0;f<y;f++){const g=i.get_add_result_at(f);l.push({id:g.id,error:{errorCode:g.error.error_code,errorMessage:g.error.error_message}})}for(let f=0;f<d;f++){const g=i.get_update_result_at(f);u.push({id:g.id,error:{errorCode:g.error.error_code,errorMessage:g.error.error_message}})}for(let f=0;f<h;f++){const g=i.get_delete_result_at(f);c.push({id:g.id,error:{errorCode:g.error.error_code,errorMessage:g.error.error_message}})}r.editResults.push({typeName:a,adds:l,updates:u,deletes:c})}return r}const rt=new Map,qi=()=>new Map(rt.entries()),z={fetchKnowledgeGraph:async e=>{const t=new ii({url:e}),r=[];return r.push(at(t)),r.push(hn(t)),await Promise.all(r),t},refreshDataModel:async e=>{e.dataModel=await wn(e)},refreshServiceDefinition:async e=>{var r,n;const t=(await W(e.url,{query:{f:"json"}})).data;return t.capabilities=(r=t==null?void 0:t.capabilities)==null?void 0:r.split(","),t.supportedQueryFormats=(n=t==null?void 0:t.supportedQueryFormats)==null?void 0:n.split(","),e.serviceDefinition=new an(t),e.serviceDefinition},executeFindPathsAsynchronous:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new w("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");const n=r[0];return await fn(`${n}/rest/services/System/KnowledgeGraphServerToolsAsync/GPServer/ServerFilteredFindPaths`,{in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:e.config.toJSON(),result_type:"STRING"},{},t)},executeFindPaths:async(e,t)=>{const r=e.inKnowledgeGraphUrl.split("/rest/services");if(r.length<2)throw new w("knowledge-graph:invalid-tool-url","The URL for the KG Service was not correctly formatted.  It should contain /reset/services/");const n=r[0],o=await mn(`${n}/rest/services/System/KnowledgeGraphServerTools/GPServer/ServerFilteredFindPaths/execute`,{method:"post",query:{f:"pjson",in_knowledge_graph_url:e.inKnowledgeGraphUrl,config_type:"STRING",config_string:JSON.stringify(e.config),result_type:"STRING"},...t});if(o.data.results.length<1)throw new w("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results returned",o);let i;for(const a of o.data.results)if(a.paramName==="out_results_string"){i=a.value;break}if(!i)throw new w("knowledge-graph:no-results","No results were returned from the FindPaths tool - no results were returned on the expected paramater out_results_string",o);return i},fetchAsynchronousFindPathsResultData:async(e,t)=>(await e.fetchResultData("out_results_string",null,t)).value,executeQueryStreaming:async(e,t,r)=>{var l;const n="include",o=`${e.url}/graph/query`;await Dt(e);const i=await ut(o,r);if(!((l=e.serviceDefinition)!=null&&l.supportsProvenance)&&t.provenanceBehavior===n)throw new w("knowledge-graph:provenance-not-supported","The Knowledge Graph Service definition indicated that provenance is not supported");i.data.body=await ea(t,e);const a=await Ke(i.data.url,i.data);if(e.dataModel){const u=await Ur(a,e.dataModel);return new Lr({resultRowsStream:u.readableStream,resultHeader:u.resultHeader})}throw new w("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},executeApplyEdits:async(e,t,r)=>{var i;if((i=e.serviceDefinition)!=null&&i.dataEditingNotSupported)throw new w("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const n=`${e.url}/graph/applyEdits`;await Dt(e);const o=await ut(n,r);return o.data.body=await Xi(t,e),ra(await Ke(o.data.url,o.data))},executeQuery:async(e,t,r)=>{var l;const n=`${e.url}/graph/query`,o=await W(n,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:t.openCypherQuery,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),i=(l=o.getHeader)==null?void 0:l.call(o,"content-type"),a=o.data;if(i!=null&&i.includes("application/x-protobuf")){const u=new(await re()).GraphQueryDecoder;if(u.deleteLater(),e.dataModel){const c=Wt({wasmQueryDecoder:u,newArrayBufferToParse:a,dataModel:e.dataModel});return new xr({resultRows:c.resultRows,resultHeader:c.resultHeader})}throw new w("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:i,data:o.data})},executeSearch:async(e,t,r)=>{var u;const n=t.typeCategoryFilter,o=`${e.url}/graph/search`,i=await W(o,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:n,...r==null?void 0:r.query},signal:r==null?void 0:r.signal,timeout:r==null?void 0:r.timeout}),a=(u=i.getHeader)==null?void 0:u.call(i,"content-type"),l=i.data;if(a!=null&&a.includes("application/x-protobuf")){const c=new(await re()).GraphQueryDecoder;if(c.deleteLater(),e.dataModel){const y=Wt({wasmQueryDecoder:c,newArrayBufferToParse:l,dataModel:e.dataModel});return new xr({resultRows:y.resultRows,resultHeader:y.resultHeader})}throw new w("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:i.data})},executeSearchStreaming:async(e,t,r)=>{const n=`${e.url}/graph/search`;await Dt(e);const o=await ut(n,r);o.data.body=await ta(t);const i=await Ke(o.data.url,o.data);if(e.dataModel){const a=await Ur(i,e.dataModel);return new Lr({resultRowsStream:a.readableStream,resultHeader:a.resultHeader})}throw new w("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")},fetchClientDataAtKeys:async(e,t,r={ignoreCache:!1})=>{if(!t.length)return new Map;let n=rt.get(e.url||"");n||(n=new Map,rt.set(e.url||"",n));const o=new Map(n.entries()),i=`${e.url}/clientData/fetch`;t=Array.from(new Set(t));const a=await re(),l=ai(t,n,a,r.ignoreCache),u=await ut(i,r.requestOptions);u.data.body=l;const c=await Ke(u.data.url,u.data),y=c.headers.get("content-type");if(y!=null&&y.includes("application/x-protobuf")){const d=new a.ClientDataFetchResponseDecoder;d.deleteLater();const h=await c.arrayBuffer();return d.decode(new Uint8Array(h)),d.has_error()&&Te(d.error,"knowledge-graph:fetchClientDataAtKeys-decoding-error","An error occurred while decoding the client data keys response"),fi(d,n,o,r.ignoreCache)}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response when fetching client data",{responseType:y,data:c})},fetchAllClientDataKeys:async(e,t)=>{var a;const r=`${e.url}/clientData`,n=await W(r,{responseType:"array-buffer",query:{f:"pbf"},signal:t==null?void 0:t.signal,timeout:t==null?void 0:t.timeout}),o=(a=n.getHeader)==null?void 0:a.call(n,"content-type"),i=n.data;if(o!=null&&o.includes("application/x-protobuf")){const l=new(await re()).ClientDataKeysResponseDecoder;return l.deleteLater(),l.decode(new Uint8Array(i)),l.has_error()&&Te(l.error,"knowledge-graph:fetchAllClientDataKeys-decoding-error","An error occurred while decoding the client data keys response"),mi(l)}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:n.data})},clearClientDataCache:()=>rt.clear(),_fetchWrapper:async(e,t)=>fetch(e,t),_submitJobWrapper:async(e,t,r,n)=>oi(e,t,r,n),_esriRequestWrapper:async(e,t)=>W(e,t)};async function Ui(e,t,r){return z.executeApplyEdits(e,t,r)}async function zi(e,t,r){return z.executeQuery(e,t,r)}async function Re(e,t,r){return z.executeQueryStreaming(e,t,r)}async function Ji(e,t,r){return z.executeSearch(e,t,r)}async function Bi(e,t,r){return z.executeSearchStreaming(e,t,r)}function Vi(e,t){return z.fetchAllClientDataKeys(e,t)}function yn(e,t,r){return z.fetchClientDataAtKeys(e,t,r)}async function Hi(e){return z.fetchKnowledgeGraph(e)}async function at(e){return z.refreshDataModel(e)}async function hn(e){return z.refreshServiceDefinition(e)}async function Qi(e,t){return z.executeFindPathsAsynchronous(e,t)}async function Yi(e,t){return z.executeFindPaths(e,t)}async function Wi(e,t){return z.fetchAsynchronousFindPathsResultData(e,t)}function Ki(){return z.clearClientDataCache()}async function Ke(e,t){return z._fetchWrapper(e,t)}async function fn(e,t,r,n){return z._submitJobWrapper(e,t,r,n)}async function mn(e,t){return z._esriRequestWrapper(e,t)}async function Dt(e){var r;((r=Dn)==null?void 0:r.findCredential(e.url))||(e.dataModel?await wn(e):await at(e))}function Zi(e,t,r,n){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof Zt?r.set_param_key_value(e,rr(t,n)):Array.isArray(t)?r.set_param_key_value(e,sn(t,n)):r.set_param_key_value(e,ln(t,n))}async function Xi(e,t){var a,l,u,c,y,d,h,f,g;if(t.dataModel||await at(t),!t.dataModel)throw new w("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const r=await re(),n=!!((a=e.options)!=null&&a.cascadeDelete),o=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),(l=e.options)!=null&&l.inputQuantizationParameters?hi((u=e.options)==null?void 0:u.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());o.deleteLater(),o.cascade_delete=n;try{let I;(c=e.entityAdds)==null||c.forEach(v=>{I=o.add_entity(lt(v,r)),Te(I,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(y=e.relationshipAdds)==null||y.forEach(v=>{if(!v.originId||!v.destinationId)throw new w("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");I=o.add_relationship(lt(v,r)),Te(I,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(d=e.entityUpdates)==null||d.forEach(v=>{if(!v.id)throw new w("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");I=o.update_entity(lt(v,r)),Te(I,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),(h=e.relationshipUpdates)==null||h.forEach(v=>{if(!v.id)throw new w("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");I=o.update_relationship(lt(v,r)),Te(I,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),(f=e.entityDeletes)==null||f.forEach(v=>{var _;if(!v.typeName)throw new w("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const m=o.make_delete_helper(v.typeName,!0);m.deleteLater(),(_=v.ids)==null||_.forEach(M=>{m.delete_by_id(M)})}),(g=e.relationshipDeletes)==null||g.forEach(v=>{var _;if(!v.typeName)throw new w("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const m=o.make_delete_helper(v.typeName,!1);(_=v.ids)==null||_.forEach(M=>{m.delete_by_id(M)})}),o.encode()}catch(I){throw new w("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:I})}const i=o.get_encoding_result();return Te(i.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),structuredClone(i.get_byte_buffer())}async function ea(e,t){var i,a;const r=await re(),n=new r.GraphQueryRequestEncoder;if(n.deleteLater(),e.outputSpatialReference?n.output_spatial_reference={wkid:e.outputSpatialReference.wkid,latestWkid:e.outputSpatialReference.latestWkid,vcsWkid:e.outputSpatialReference.vcsWkid,latestVcsWkid:e.outputSpatialReference.latestVcsWkid,wkt:e.outputSpatialReference.wkt??""}:n.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),n.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[l,u]of Object.entries(e.bindParameters))Zi(l,u,n,r);if(e.bindGeometryQuantizationParameters)li(e.bindGeometryQuantizationParameters,n);else{if(t.dataModel||await at(t),((a=(i=t.dataModel)==null?void 0:i.spatialReference)==null?void 0:a.wkid)!==4326)throw new w("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");n.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&pi(e.outputQuantizationParameters,n,r),e.provenanceBehavior&&ui(e.provenanceBehavior,n);try{n.encode()}catch(l){throw new w("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:l})}const o=n.get_encoding_result();if(o.error.error_code!==0)throw new w("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return structuredClone(o.get_byte_buffer())}async function ta(e){var o;const t=await re(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(sn(e.idsFilter,t))}catch(i){throw new w("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:i})}(o=e.namedTypesFilter)==null||o.forEach(i=>{r.add_named_type_filter(i)});try{r.encode()}catch(i){throw new w("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:i})}const n=r.get_encoding_result();if(n.error.error_code!==0)throw new w("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:n.error.error_code,errorMessage:n.error.error_message});return structuredClone(n.get_byte_buffer())}async function ut(e,t){return W(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t==null?void 0:t.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t==null?void 0:t.signal,timeout:t==null?void 0:t.timeout})}async function ra(e){const t=e.headers.get("content-type");if(t!=null&&t.includes("application/x-protobuf")){const r=await e.arrayBuffer(),n=new(await re()).GraphApplyEditsDecoder;return n.deleteLater(),n.decode(new Uint8Array(r)),Ai(n)}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}let gn=50;function na(e){gn=e}function Wt({wasmQueryDecoder:e,newArrayBufferToParse:t,dataModel:r,decodedHeader:n,limitMaxProcessingTime:o=!1}){t&&e.push_buffer(new Uint8Array(t));const i=[];let a,l,u=0;const c=Date.now();let y=!0;for(;e.next_row();){a&&l||(a=n??Oi(e),l=a.outSpatialReference??new de({wkid:4326})),u||(u=e.get_header_keys().size());const d=new Array(u);for(let h=0;h<u;h++){const f=e.get_value(h);d[h]=ir(f,r,l)}if(i.push(d),o&&Date.now()-c>gn){y=!1;break}}if(e.has_error())throw new w("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - inner row decoding",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return{resultHeader:a,resultRows:i,parsedAllResultsFromBuffer:y}}async function Ur(e,t){var n;const r=e.headers.get("content-type");if(e.headers.get("content-length")&&Ae.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r==null?void 0:r.includes("application/x-protobuf")){const o=(n=e.body)==null?void 0:n.getReader(),i=new(await re()).GraphQueryDecoder;let a,l,u;i.deleteLater();const c=new Promise((f,g)=>{l=f,u=g});let y=!1,d=null;return{readableStream:new ReadableStream({pull:async function f(g){if(!o){const m=new w("knowledge-graph:stream-decoding-error","Error reading from stream - reader is undefined");throw u(m),m}const{done:I,value:v}=d?{done:!1,value:null}:await o.read().catch(m=>{throw u(m),o.releaseLock(),m});v&&(d=v);try{if(I){let G;if(i.has_error()?G=new w("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded - query stream done",{errorCode:i.error.error_code,errorMessage:i.error.error_message}):y||l(new vt),o.releaseLock(),G)throw g.error(G),u(G),G;return void g.close()}const{resultHeader:m,resultRows:_,parsedAllResultsFromBuffer:M}=Wt({wasmQueryDecoder:i,newArrayBufferToParse:v,dataModel:t,decodedHeader:a,limitMaxProcessingTime:!0});return M&&(d=null),!a&&m&&(a=m,l(m),y=!0),_.length>0?void g.enqueue(_):await f(g)}catch(m){throw Ae.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").error(m),u(m),o.releaseLock(),Mn(m)?m:new w("knowledge-graph:unexpected-server-response","Error inside streaming data return parsing",{error:m})}}}),resultHeader:await c}}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})}async function wn(e){var i;const t=`${e.url}/dataModel/queryDataModel`,r=await W(t,{responseType:"array-buffer",query:{f:"pbf"}}),n=(i=r.getHeader)==null?void 0:i.call(r,"content-type"),o=r.data;if(n!=null&&n.includes("application/x-protobuf")){const a=(await re()).decode_data_model_from_protocol_buffer(new Uint8Array(o));if(!a)throw new w("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return wi(a)}throw new w("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:r.data})}const as=Object.freeze(Object.defineProperty({__proto__:null,_esriRequestWrapper:mn,_fetchWrapper:Ke,_getClientDataCacheCopy:qi,_setMaxQueryParsingDurationForTesting:na,_submitJobWrapper:fn,clearClientDataCache:Ki,clientDataCache:rt,executeApplyEdits:Ui,executeFindPaths:Yi,executeFindPathsAsynchronous:Qi,executeQuery:zi,executeQueryStreaming:Re,executeSearch:Ji,executeSearchStreaming:Bi,fetchAllClientDataKeys:Vi,fetchAsynchronousFindPathsResultData:Wi,fetchClientDataAtKeys:yn,fetchKnowledgeGraph:Hi,kgRestServices:z,refreshDataModel:at,refreshServiceDefinition:hn},Symbol.toStringTag,{value:"Module"}));function oa(e,t){var n,o;const r=new Map;if((n=t.dataModel)!=null&&n.relationshipTypes)for(const i of t.dataModel.relationshipTypes)i.name&&r.set(i.name,[]);for(const i of e)r.has(i.typeName)&&((o=r.get(i.typeName))==null||o.push(i.id));return r}async function ss(e,t,r){const n=[],o=oa(e,t),i={},a=[];for(const[y,d]of o){if(d.length<1)continue;const h=`${y}_ids`;i[h]=d,a.push(`MATCH (n)-[r:${y}]->(m) WHERE id(r) in $${h} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(a.length===0)return[];const l=a.join(" UNION "),u=new Ie({openCypherQuery:l,bindParameters:i}),c=(await Re(t,u,r==null?void 0:r.requestOptions)).resultRowsStream.getReader();for(;;){const{done:y,value:d}=await c.read();if(y)break;for(const h of d)n.push({id:h[0],typeName:h[1]}),n.push({id:h[2],typeName:h[3]})}return n}const ls=e=>Bo.get(e)??"radial-root-centric";function ia(e){if(!e.spatialReference.isWGS84)throw new w("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(t=>[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]])}let ae=class extends Me{constructor(e){var r,n,o;super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;(r=e.knowledgeGraph.dataModel.entityTypes)==null||r.forEach(i=>{var a,l;i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!((a=e.inclusionModeDefinition)!=null&&a.generateAllSublayers)||this.entityTypeNames.add(i.name),(l=i.properties)==null||l.forEach(u=>{u.geometryType&&u.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:u.name??"",geometryType:u.geometryType})}))}),(n=e.knowledgeGraph.dataModel.relationshipTypes)==null||n.forEach(i=>{var a,l;i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!((a=e.inclusionModeDefinition)!=null&&a.generateAllSublayers)||this.relationshipTypeNames.add(i.name),(l=i.properties)==null||l.forEach(u=>{u.geometryType&&u.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(i.name,{name:u.name??"",geometryType:u.geometryType})}))}),(o=e.inclusionModeDefinition)==null||o.namedTypeDefinitions.forEach((i,a)=>{var u,c;if(t.get(a)==="entity")this.entityTypeNames.add(a);else{if(t.get(a)!=="relationship")return Ae.getLogger(this).warn(`A named type, ${a}, was in the inclusion list that wasn't in the data model and will be removed`),void((u=e.inclusionModeDefinition)==null?void 0:u.namedTypeDefinitions.delete(a));this.relationshipTypeNames.add(a)}const l=new Map;(c=i.members)==null||c.forEach(y=>{fe(this.memberIdTypeLookup,y.id,()=>new Set).add(a);const d=this.getById(y.id);d&&l.set(y.id,d)}),this.sublayerCaches.set(a,l)})}addToLayer(e){e.forEach(({typeName:t,id:r})=>{if(!this.inclusionModeDefinition)throw new w("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const n=this.inclusionModeDefinition.namedTypeDefinitions.get(t);n.members||(n.members=new Map),n.members.set(r,{id:r}),fe(this.memberIdTypeLookup,r,()=>new Set).add(t)}}else{const n=new Map;n.set(r,{id:r}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:n}),fe(this.memberIdTypeLookup,r,()=>new Set).add(t)}})}getById(e){return $t.getInstance().readFromStoreById(e)}async getData(e,t,r){var o,i;if(t.objectType.name&&((o=this.inclusionModeDefinition)!=null&&o.namedTypeDefinitions)&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new Pe({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){const a=t.parentCompositeLayer,l=this._processingCacheUpdatesLookup.get(t.objectType.name??""),u=n.outFields;u&&u.length===1&&u[0]===le&&n.where==="1=1"||await Promise.all(l??[]);const c=this.sublayerCaches.has(t.objectType.name??"")?Array.from((i=this.sublayerCaches.get(t.objectType.name))==null?void 0:i.values()):[],y=[];return c.forEach(d=>{if(this.relationshipTypeNames.has(t.objectType.name)){d.geometry=a.relationshipLinkChartDiagramLookup.get(d.attributes[t.objectIdField]);const h=this.memberIdTypeLookup.get(d.attributes[ft]),f=this.memberIdTypeLookup.get(d.attributes[mt]),g=this._isEndEntitySpatial(h,d,ft),I=this._isEndEntitySpatial(f,d,mt);d.attributes[tt]=Number(g&&I)}else{d.geometry=a.entityLinkChartDiagramLookup.get(d.attributes[t.objectIdField]);const h=this.geographicLookup.get(t.objectType.name);h&&d.attributes[h.name]?d.attributes[tt]=1:d.attributes[tt]=0}d.attributes[er]=d.geometry,y.push(d)}),y}return this.retrieveDataFromService(n,t,r)}async getConnectedRecordIds(e,t,r){const n=[];let o="";const i=this._getNamedTypeIdMapFromNodeIds(e);if(t&&(t==null?void 0:t.length)!==0){for(const y of t)o=o+y+"|";o=o.slice(0,-1)}const a={},l=[];for(const[y,d]of i){const h=`${y}_ids`;a[h]=d,t&&(t==null?void 0:t.length)!==0?l.push(`MATCH (n:${y}) WHERE id(n) IN $${h} WITH n MATCH (n)-[r:${o}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):l.push(`MATCH (n:${y}) WHERE id(n) IN $${h} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!l.length)return n;const u=l.join(" UNION "),c=(await Re(this.knowledgeGraph,new Ie({openCypherQuery:u,bindParameters:a}),{signal:r==null?void 0:r.signal})).resultRowsStream.getReader();for(;;){const{done:y,value:d}=await c.read();if(y)break;for(let h=0;h<d.length;h++){const f=d[h];n.push({id:f[0],typeName:f[1]}),n.push({id:f[2],typeName:f[3]})}}return n}async getRelationshipsBetweenNodes(e,t,r){const n=this._getNamedTypeIdMapFromNodeIds(e);if(n.size===0)return[];const o={relationshipExclusionIds:t,possibleConnectionEntityIds:e},i=[];for(const[c,y]of n.entries()){const d=`${c}_ids`;o[d]=y,i.push(`MATCH (n:${c}) WHERE id(n) IN $${d} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=i.join(" UNION "),l=[],u=(await Re(this.knowledgeGraph,new Ie({openCypherQuery:a,bindParameters:o}),{signal:r==null?void 0:r.signal})).resultRowsStream.getReader();for(;;){const{done:c,value:y}=await u.read();if(c)break;for(let d=0;d<y.length;d++){const h=y[d];l.push({id:h[0],typeName:h[1]})}}return l}async getRelationshipsFromNodes(e,t,r,n){const o=this._getNamedTypeIdMapFromNodeIds(e);if(o.size===0||t.length===0)return[];const i={relationshipExclusionIds:r,possibleConnectionEntityIds:t},a=[];for(const[d,h]of o.entries()){const f=`${d}_ids`;i[f]=h,a.push(`MATCH (n:${d}) WHERE id(n) IN $${f} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const l=a.join(" UNION "),u=new Map,c=(await Re(this.knowledgeGraph,new Ie({openCypherQuery:l,bindParameters:i}),{signal:n==null?void 0:n.signal})).resultRowsStream.getReader();for(;;){const{done:d,value:h}=await c.read();if(d)break;for(let f=0;f<h.length;f++){const g=h[f];let I=u.get(g[1]);I||(I=new Set,u.set(g[1],I)),I.add(g[0])}}const y=[];for(const[d,h]of u)for(const f of h)y.push({id:f,typeName:d});return y}async refreshCacheContent(e,t,r,n=!0,o){var c,y,d,h,f,g,I,v;const i=$t.getInstance(),a=[],l=new Map,u=new Map;(c=this.knowledgeGraph.dataModel.entityTypes)==null||c.forEach(m=>{m.name&&u.set(m.name,m)}),(y=this.knowledgeGraph.dataModel.relationshipTypes)==null||y.forEach(m=>{m.name&&u.set(m.name,m)}),e||this.inclusionModeDefinition?e?e.forEach(m=>{var _;if(this.memberIdTypeLookup.has(m))for(const M of this.memberIdTypeLookup.get(m))l.has(M)?(_=l.get(M))==null||_.push(m):l.set(M,[m])}):(h=(d=this.inclusionModeDefinition)==null?void 0:d.namedTypeDefinitions)==null||h.forEach((m,_)=>{m.useAllData?l.set(_,null):m.members&&m.members.forEach(M=>{var G;l.has(_)&&l.get(_)!==null?(G=l.get(_))==null||G.push(M.id):l.set(_,[M.id])})}):((f=this.knowledgeGraph.dataModel.entityTypes)==null||f.forEach(m=>{m.name&&l.set(m.name,null)}),(g=this.knowledgeGraph.dataModel.entityTypes)==null||g.forEach(m=>{m.name&&l.set(m.name,null)}));for(const[m,_]of l){const M=new Set(_),G=new Promise((A,k)=>{(async()=>{var ce,$,E,C,F,x,L,U,D;const N=new Set,P=[];let Q,q="",Y=!1;if(t||(($=(ce=u.get(m))==null?void 0:ce.properties)==null||$.forEach(b=>{b.name&&N.add(b.name)})),r&&this.geographicLookup.has(m)){const b=(E=this.geographicLookup.get(m))==null?void 0:E.name;b&&N.add(b)}if(this.entityTypeNames.has(m))q=`MATCH (n:${m}) ${_?"WHERE id(n) IN $ids ":""}return ID(n)`,N.forEach(b=>{q+=`, n.${b}`,P.push(b)});else{if(!this.relationshipTypeNames.has(m))throw new w("knowledge-graph:layer-data-manager",`The graph type of ${m} could not be determined. Was this type set in the KG data model and inclusion definition?`);Y=!0,q=`MATCH ()-[n:${m}]->() ${_?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,N.forEach(b=>{q+=`, n.${b}`,P.push(b)})}Q=new Ie(_?{openCypherQuery:q,bindParameters:{ids:_}}:{openCypherQuery:q});const ne=(await Re(this.knowledgeGraph,Q,{signal:o==null?void 0:o.signal})).resultRowsStream.getReader();for(;;){const{done:b,value:ge}=await ne.read();if(b)break;const ie=[];for(let pe=0;pe<ge.length;pe++){const we=ge[pe];let Z=0,st=0;const X={properties:{}};for(X.id=we[Z],Z++,st++,Y&&(X.originId=we[Z],Z++,st++,X.destinationId=we[Z],Z++,st++,fe(this.nodeConnectionsLookup,X.originId,()=>new Set).add(X.id),fe(this.nodeConnectionsLookup,X.destinationId,()=>new Set).add(X.id),fe(this.relationshipConnectionsLookup,X.id,()=>[X.originId,X.destinationId]));Z<we.length;Z++)X.properties[P[Z-st]]=we[Z];M.delete(X.id),ie.push(X)}const Tn=i.writeToStore(ie,le,(C=this.geographicLookup.get(m))==null?void 0:C.name);this.sublayerCaches.has(m)||this.sublayerCaches.set(m,new Map),n&&!((F=this.inclusionModeDefinition)!=null&&F.namedTypeDefinitions.has(m))&&((x=this.inclusionModeDefinition)==null||x.namedTypeDefinitions.set(m,{useAllData:!1,members:new Map})),n&&!((L=this.inclusionModeDefinition)!=null&&L.namedTypeDefinitions.get(m).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(m).members=new Map);const It=this.sublayerCaches.get(m);Tn.forEach(pe=>{var we,Z;It==null||It.set(pe.attributes[le],pe),n&&!((we=this.inclusionModeDefinition)!=null&&we.namedTypeDefinitions.get(m).members.has(pe.attributes[le]))&&((Z=this.inclusionModeDefinition)==null||Z.namedTypeDefinitions.get(m).members.set(pe.attributes[le],{id:pe.attributes[le]}),fe(this.memberIdTypeLookup,pe.attributes[le],()=>new Set).add(m))})}const V=(U=this.inclusionModeDefinition)==null?void 0:U.namedTypeDefinitions.get(m);if(V)for(const b of M)(D=V.members)==null||D.delete(b)})().then(()=>{A(null)}).catch(N=>{N.name==="AbortError"?A(null):k(N)})});a.push(G),(I=this._processingCacheUpdatesLookup.get(m))==null||I.push(G)}if(await Promise.all(a),(v=o==null?void 0:o.signal)==null?void 0:v.aborted)throw Je()}removeFromLayer(e){var n,o,i;const t=new Set,r=new Set(e.map(a=>a.id));for(const a of e)t.add(a.typeName),((n=this.memberIdTypeLookup.get(a.id))==null?void 0:n.size)===1?this.memberIdTypeLookup.delete(a.id):(o=this.memberIdTypeLookup.get(a.id))==null||o.delete(a.typeName),(i=this.inclusionModeDefinition)==null||i.namedTypeDefinitions.forEach((l,u)=>{var c;u===a.typeName&&((c=l.members)!=null&&c.has(a.id))&&l.members.delete(a.id)});t.forEach(a=>{var l;(l=this.sublayerCaches.get(a))==null||l.forEach((u,c)=>{var y;r.has(c)&&((y=this.sublayerCaches.get(a))==null||y.delete(c))})})}async retrieveDataFromService(e,t,r){var g,I,v,m,_,M,G,A,k,R,N,P,Q,q,Y,ne,V,ce;const n=$t.getInstance(),o=new Set,i=[];let a,l="",u=[];const c=t.graphType==="relationship",y=(v=(I=(g=this.inclusionModeDefinition)==null?void 0:g.namedTypeDefinitions)==null?void 0:I.get(t.objectType.name))==null?void 0:v.useAllData,d=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let h=!y&&d?Array.from(d).sort():null;if((M=(_=(m=this.inclusionModeDefinition)==null?void 0:m.namedTypeDefinitions)==null?void 0:_.get(t.objectType.name))!=null&&M.useAllData)(k=(A=(G=this.inclusionModeDefinition)==null?void 0:G.namedTypeDefinitions)==null?void 0:A.get(t.objectType.name))!=null&&k.useAllData&&e.objectIds!=null&&(h=e.objectIds);else if(e.objectIds!=null&&h&&h.length>0){const $=e.objectIds;e.objectIds=h.filter(E=>$.includes(E))}else if(e.objectIds!=null)h=e.objectIds;else{if((R=this.inclusionModeDefinition)!=null&&R.namedTypeDefinitions.has(t.objectType.name)&&(!((N=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))!=null&&N.members)||((Q=(P=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))==null?void 0:P.members)==null?void 0:Q.size)<1))return e.objectIds=[],[];e.objectIds=h}if(e.outFields!=null){const $=e.outFields;$.includes("*")?t.fields.forEach(E=>{o.add(E.name)}):$.forEach(E=>{E!==le&&E!==t.geometryFieldName&&o.add(E)})}if(e.geometry!=null){const $=e.geometry;let E;const C=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,F=C==null?void 0:C.spatialReference,x=(q=C==null?void 0:C.serviceCapabilities)==null?void 0:q.geometryCapabilities;let L=x==null?void 0:x.geometryMaxBoundingRectangleSizeX,U=x==null?void 0:x.geometryMaxBoundingRectangleSizeY;if($.type==="point"){let D=$;(Y=D.spatialReference)!=null&&Y.isWGS84||(await jt(D.spatialReference,be),D=dt(D,be)),E=new Fe({spatialReference:be,xmin:D.x-1e-4,ymin:D.y-1e-4,xmax:D.x+1e-4,ymax:D.y+1e-4})}else(ne=$==null?void 0:$.extent)!=null&&ne.spatialReference&&!((V=$.spatialReference)!=null&&V.isWGS84)?(await jt($.extent.spatialReference,be),E=dt($.extent,be)):E=$.extent;if(L&&U&&F){if(F.wkid!==4326){const D=new Fe({spatialReference:F,xmax:L,ymax:U}),b=dt(D,be);L=b.xmax,U=b.ymax}if(E.xmax-E.xmin>L)throw new w("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${L} latitude, limit exceeded`);if(E.ymax-E.ymin>U)throw new w("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${U} longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){const D=await pr(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(b=>{D.fieldNames.includes(b.name)&&o.add(b.name)})}l=c?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(D=>{l+=`, n.${D}`,i.push(D)}),a=new Ie({openCypherQuery:l,bindParameters:{param_filter_geom:new it({rings:ia(E)})}})}else{let $="";if(e.where!=null&&e.where!=="1=1"){const F=await pr(e.where,t.fieldsIndex);t.fields.forEach(b=>{F.fieldNames.includes(b.name)&&o.add(b.name)});const x=new Set(["column-reference","string","number","binary-expression"]),L=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let U=!1;const D=b=>{if(b.type==="column-reference")return`n.${b.column}`;if(b.type==="string")return`'${b.value}'`;if(b.type==="number")return`${b.value}`;if(b.type==="binary-expression"&&x.has(b.left.type)&&x.has(b.right.type)&&L.has(b.operator))return`${D(b.left)} ${b.operator} ${D(b.right)}`;if(b.type==="binary-expression"&&b.operator==="LIKE"){let ge="";if(b.left.type==="function"&&b.left.args.value[0].type==="column-reference")ge+=`lower(n.${b.left.args.value[0].column})`;else{if(b.left.type!=="column-reference")return U=!0,"";ge+=`lower(n.${b.left.column})`}if(ge+=" CONTAINS (",b.right.type!=="string")return U=!0,"";{let ie=b.right.value;ie.charAt(0)==="%"&&(ie=ie.slice(1)),ie.charAt(ie.length-1)==="%"&&(ie=ie.slice(0,-1)),ge+=`'${ie.toLowerCase()}')`}return ge}return U=!0,""};$=D(F.parseTree),U&&($="")}let E="";E=c?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let C=!1;h&&(C=!0,E+=" WHERE ID(n) IN $ids"),$&&(E+=C?" AND":" WHERE",E+=` ${$}`),E+=" return ID(n)",c&&(E+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&o.add(t.geometryFieldName),o.forEach(F=>{E+=`, n.${F}`,i.push(F)}),a=new Ie(h?{openCypherQuery:E,bindParameters:{ids:h}}:{openCypherQuery:E})}const f=(await Re(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){const{done:$,value:E}=await f.read();if($)break;const C=[];for(let F=0;F<E.length;F++){const x=E[F];let L=0,U=0;const D={properties:{}};for(D.id=x[L],L++,U++,c&&(D.originId=x[L],L++,U++,D.destinationId=x[L],L++,U++);L<x.length;L++)D.properties[i[L-U]]=x[L];C.push(D)}u=u.concat(n.writeToStore(C,le,(ce=t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name))==null?void 0:ce.name))}return u}_isEndEntitySpatial(e,t,r){var n;for(const o of e??[])if(this.entityTypeNames.has(o)){const i=this.geographicLookup.get(o),a=i&&((n=this.sublayerCaches.get(o))==null?void 0:n.get(t.attributes[r]));if(i&&(a!=null&&a.attributes[i.name]))return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach(r=>{var n;if(this.memberIdTypeLookup.has(r))for(const o of this.memberIdTypeLookup.get(r)){if(!this.entityTypeNames.has(o))return;t.has(o)?(n=t.get(o))==null||n.push(r):t.set(o,[r])}}),t}};s([p()],ae.prototype,"knowledgeGraph",void 0),s([p()],ae.prototype,"inclusionModeDefinition",void 0),s([p()],ae.prototype,"entityTypeNames",void 0),s([p()],ae.prototype,"relationshipTypeNames",void 0),s([p()],ae.prototype,"geographicLookup",void 0),s([p()],ae.prototype,"sublayerCaches",void 0),s([p()],ae.prototype,"nodeConnectionsLookup",void 0),s([p()],ae.prototype,"relationshipConnectionsLookup",void 0),s([p()],ae.prototype,"memberIdTypeLookup",void 0),ae=s([j("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],ae);const zr=Pn(),aa=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return s([p(zr.fields)],t.prototype,"fields",void 0),s([p(zr.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=s([j("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t},sa={initializeLayersFromClientData:async(e,t,r)=>{if(t||(t=[...e.layers,...e.tables].map(i=>i.graphTypeName)),(t==null?void 0:t.length)===0)return;const n=new Map;for(const i of t)n.set(i,Jr(e,i));const o=await yn(e.dataManager.knowledgeGraph,Array.from(n.values()),{requestOptions:{signal:r==null?void 0:r.signal}});for(const i of[...e.layers,...e.tables]){const a=i.objectType.name;if(a==null)continue;const l=o.get(Jr(e,a));if(l){const u=JSON.parse(l);u===null||typeof u!="object"||u.hasOwnProperty("showLabels")||(u.showLabels=!1),i.read(u,{origin:"service"})}}}},Jr=(e,t)=>e.type==="knowledge-graph"?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function ps(e,t,r){return sa.initializeLayersFromClientData(e,t,r)}const Br=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],la="#8f8f82";function pa(e){return e<0||e>=Br.length?new ur(la):new ur(Br[e])}function ua(e){const t=e.toArray();return new jn({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function da(e){let t="ESRI__ID",r=4;for(const n of e)if(n.name){if(n.name.toLowerCase()==="name"){t=n.name;break}n.name.toLowerCase().includes("name")?(t=n.name,r=2):n.fieldType==="esriFieldTypeString"&&r>3&&(t=n.name,r=3)}return t}function ca(e,t,r){const n={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},o=new Oe({labelExpressionInfo:new et({expression:r==="ESRI__ID"?`${t}`:`$feature.${r}`}),labelPlacement:"above-center",symbol:new Xe(n)}),i=new Oe({labelExpressionInfo:new et({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new Xe({...n,yoffset:"12px"})});return e==="entity"?[o]:[i]}function ya(e,t,r){const n={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},o=r==="ESRI__ID"?`${e}`:`$feature.${r}`;return t==="point"?[new Oe({labelExpressionInfo:new et({expression:o}),labelPlacement:"above-center",symbol:new Xe(n)})]:t==="polyline"?[new Oe({labelExpressionInfo:new et({expression:o}),labelPlacement:"center-along",repeatLabel:!0,symbol:new Xe(n)})]:t==="polygon"?[new Oe({labelExpressionInfo:new et({expression:o}),labelPlacement:"always-horizontal",symbol:new Xe(n)})]:null}function te(e){if(!e.json)return e;e.json.write=Vr(e.json.write);const t=e.json.origins;if(!t)return e;let r;for(r in t){const n=t[r];n&&(n.write=Vr(n.write))}return e}function Vr(e){return typeof e=="object"&&e?(e.enabled!==!1&&(e.overridePolicy=ha(e)),e):e===!0?Ze():e}function ha(e){const{target:t,writer:r,overridePolicy:n,...o}=e;return function(i,a){const l=_n.call(this,i,a);return l.enabled?{...o,...l}:l}}function Ze(){return{overridePolicy:_n}}function _n(e,t){const r=!!this.geometryType;let n={enabled:r};return r&&(n={...n,...bn.call(this,e,t)}),n}function bn(e,t){return{ignoreOrigin:this.originIdOf(t)>yo.DEFAULTS}}let T=class extends aa(kn(Gn(Cn(xn(Ln(On(Fn(An(qn(Hn)))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=_o(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=le,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const t=new MessageChannel;return new Un(t.port1,{channel:t,client:{queryFeatures:(r,n={})=>{const o=Pe.fromJSON(r);return this.queryFeaturesJSON(o,n)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){var t,r;const e=[];return(r=(t=this.objectType)==null?void 0:t.properties)==null||r.forEach(n=>{const o=n.fieldType==="esriFieldTypeOID"?"esriFieldTypeInteger":n.fieldType;e.push(ze.fromJSON({name:n.name,type:o,alias:n.alias,defaultValue:n.defaultValue,editable:n.editable,nullable:n.nullable}))}),e.push(ze.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),ze.fromJSON({name:kt,type:"esriFieldTypeInteger",alias:kt,editable:!1}),ze.fromJSON({name:tt,type:"esriFieldTypeInteger",alias:tt,editable:!1})),e}get geometryType(){var r,n,o;if(((r=this.parentCompositeLayer)==null?void 0:r.type)==="link-chart")return this.graphType==="relationship"?"polyline":"point";const e=(o=this.parentCompositeLayer)==null?void 0:o.dataManager.geographicLookup.get((n=this.objectType)==null?void 0:n.name),t=e==null?void 0:e.geometryType;return t&&t!=="esriGeometryNull"?Ue.fromJSON(t):null}get geometryFieldName(){var t,r,n;if(((t=this.parentCompositeLayer)==null?void 0:t.type)==="link-chart")return er;const e=(n=this.parentCompositeLayer)==null?void 0:n.dataManager.geographicLookup.get((r=this.objectType)==null?void 0:r.name);return(e==null?void 0:e.name)??null}get graphTypeName(){var e;return(e=this.objectType)==null?void 0:e.name}get hasM(){var n,o,i,a;const e=(o=this.parentCompositeLayer)==null?void 0:o.dataManager.geographicLookup.get((n=this.objectType)==null?void 0:n.name),t=e==null?void 0:e.name,r=t?(a=(i=this.objectType)==null?void 0:i.properties)==null?void 0:a[t]:null;return(r==null?void 0:r.hasM)??!1}get hasZ(){var n,o,i,a;const e=(o=this.parentCompositeLayer)==null?void 0:o.dataManager.geographicLookup.get((n=this.objectType)==null?void 0:n.name),t=e==null?void 0:e.name,r=t?(a=(i=this.objectType)==null?void 0:i.properties)==null?void 0:a[t]:null;return(r==null?void 0:r.hasZ)??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");const e=this.objectType.properties?da(this.objectType.properties):"ESRI__ID";return this.parentCompositeLayer.type==="link-chart"?ca(this.graphType,this.graphTypeName,e):ya(this.graphTypeName,this.geometryType,e)}set renderer(e){zn(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){var o,i,a,l;if(this._isOverridden("renderer"))return this._get("renderer");const e=(a=(i=(o=this.parentCompositeLayer)==null?void 0:o.dataManager)==null?void 0:i.knowledgeGraph)==null?void 0:a.dataModel,t=[...(e==null?void 0:e.entityTypes)??[],...(e==null?void 0:e.relationshipTypes)??[]].map(u=>u.name).indexOf(this.graphTypeName),r=pa(t);if(((l=this.parentCompositeLayer)==null?void 0:l.type)==="link-chart"){if(this.graphType==="relationship")return new Jn({type:"simple",symbol:ua(r)});const u=dr(yr(Ue.toJSON("point")).renderer);return cr(u.symbol,r),u}const n=dr(yr(Ue.toJSON(this.geometryType)).renderer);return cr(n.symbol,r),n}get spatialReference(){var e,t,r,n;return((n=(r=(t=(e=this.parentCompositeLayer)==null?void 0:e.dataManager)==null?void 0:t.knowledgeGraph)==null?void 0:r.dataModel)==null?void 0:n.spatialReference)??de.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return Bn(this,e)}createQuery(){return new Pe({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e),o=ht.fromJSON(await n.executeQuery(r.toJSON(),t==null?void 0:t.signal));return o.features.forEach(i=>{i.sourceLayer=this}),o}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(r.toJSON(),t==null?void 0:t.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:r,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(r.toJSON(),t==null?void 0:t.signal)}async queryExtent(e={},t){var l,u,c,y;await this.load();const r={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:o}=await this._setupQueryObjects(r),i=await o.executeQueryForExtent(n.toJSON(),t==null?void 0:t.signal);let a;return a=((l=i.extent)==null?void 0:l.xmin)!=null&&((u=i.extent)==null?void 0:u.xmax)!=null&&((c=i.extent)==null?void 0:c.ymin)!=null&&((y=i.extent)==null?void 0:y.ymax)!=null?new Fe(i.extent):new Fe,{count:i.count,extent:a}}async queryObjectIds(e,t){await this.load();const r=Pe.from(e);let n;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const o=await this.parentCompositeLayer.dataManager.getData(r,this,t);n=this.loadQueryEngine(o)}return await n.executeQueryForIds(r.toJSON(),t==null?void 0:t.signal)}loadQueryEngine(e){var n;const t=new go({geometryType:Ue.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new wo({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Ue.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:(n=this.timeInfo)==null?void 0:n.toJSON(),featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new Pe({where:"1=1",outFields:[le]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>Vn(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){var i;const r=Pe.from(e),n=r.geometry;if(n&&!((i=n.spatialReference)!=null&&i.isWGS84)&&(await jt(n.spatialReference,be),r.geometry=dt(n instanceof it||n instanceof Tt||n instanceof Xt?n:n.extent,be)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)return{resolvedQuery:r,queryEngine:this._cachedQueryEngine};const o=await this.parentCompositeLayer.dataManager.getData(r,this,t);return{resolvedQuery:r,queryEngine:this.loadQueryEngine(o)}}};s([p(te(ee(Qn)))],T.prototype,"blendMode",void 0),s([p()],T.prototype,"capabilities",void 0),s([p({json:{origins:{"web-scene":{write:!1}},write:Ze()}})],T.prototype,"charts",void 0),s([p({readOnly:!0})],T.prototype,"defaultPopupTemplate",null),s([p({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],T.prototype,"definitionExpression",void 0),s([p()],T.prototype,"displayField",void 0),s([p(te(ee(Yn)))],T.prototype,"displayFilterEnabled",void 0),s([p(te(ee(Wn)))],T.prototype,"displayFilterInfo",void 0),s([p(te(ee(Kn)))],T.prototype,"effect",void 0),s([p()],T.prototype,"elevationInfo",void 0),s([p(te(ee(Zn)))],T.prototype,"featureEffect",void 0),s([p(te(ee(Xn)))],T.prototype,"featureReduction",null),s([p()],T.prototype,"fields",null),s([p()],T.prototype,"geometryType",null),s([p()],T.prototype,"geometryFieldName",null),s([p({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],T.prototype,"graphType",void 0),s([p({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],T.prototype,"graphTypeName",null),s([p()],T.prototype,"hasM",null),s([p()],T.prototype,"hasZ",null),s([p({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],T.prototype,"id",void 0),s([p({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],T.prototype,"labelsVisible",void 0),s([p({type:[Oe],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:fa,write:Ze()}})],T.prototype,"labelingInfo",null),s([p({readOnly:!0,json:{read:!1,write:{writer(e,t){var r;switch((r=this.parentCompositeLayer)==null?void 0:r.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],T.prototype,"layerType",void 0),s([p(te(ee(eo)))],T.prototype,"legendEnabled",void 0),s([p(te(ee(to)))],T.prototype,"maxScale",void 0),s([p(te(ee(ro)))],T.prototype,"minScale",void 0),s([p()],T.prototype,"objectIdField",void 0),s([p()],T.prototype,"objectType",void 0),s([p(te(ee(no)))],T.prototype,"opacity",void 0),s([p(te(ee(oo)))],T.prototype,"orderBy",void 0),s([p({clonable:!1})],T.prototype,"parent",void 0),s([p()],T.prototype,"parentCompositeLayer",void 0),s([p(te(ee(io)))],T.prototype,"popupEnabled",void 0),s([p({type:ao,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],T.prototype,"popupTemplate",void 0),s([p({type:Number,json:{write:{overridePolicy:bn}}})],T.prototype,"refreshInterval",void 0),s([p({types:so,json:{name:"layerDefinition.drawingInfo.renderer",write:Ze()}})],T.prototype,"renderer",null),s([p()],T.prototype,"source",void 0),s([p()],T.prototype,"spatialReference",null),s([p({type:lo,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],T.prototype,"timeInfo",null),s([p({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],T.prototype,"title",null),s([po("title")],T.prototype,"writeTitle",null),s([p({json:{read:!1}})],T.prototype,"type",void 0),s([p(te(ee(uo)))],T.prototype,"useViewTime",void 0),s([p({type:Boolean,json:{name:"visibility",write:Ze()}})],T.prototype,"visible",void 0),T=s([j("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],T);const us=T;function fa(e,t,r){var o,i;const n=[["ESRI__AGGREGATION_COUNT",kt],["ESRI__ORIGIN_ID",ft],["ESRI__DESTINATION_ID",mt],["ESRI__LAYOUT_GEOMETRY",er]];try{for(const a of e)for(const[l,u]of n)a.labelExpression=(o=a.labelExpression)==null?void 0:o.replaceAll(l,u),(i=a.labelExpressionInfo)!=null&&i.expression&&(a.labelExpressionInfo.expression=a.labelExpressionInfo.expression.replaceAll(l,u))}catch(a){Ae.getLogger(this).warn("Error updating labelingInfo",a)}return co(e,t,r)}export{Rr as A,ls as C,Oa as D,ae as E,Hi as I,Mr as P,us as S,Dr as _,jr as a,Nr as b,Pr as c,br as d,Fa as e,me as f,ss as g,La as h,ps as i,as as k,xa as m,$t as o,Tr as u,$r as v};
